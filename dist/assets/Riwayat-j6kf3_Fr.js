import{r as V,u as J,j as s}from"./index-Drn00l2W.js";import{c as $,o as Q,r as Y,H as q,d as ee}from"./Header-WEJhPpCK.js";import{c as ne}from"./Threshold-oAy1CT4A.js";import{T as se,W as re}from"./wind-CdYYL5U7.js";import{D as _}from"./droplets-Bx8S2IPS.js";import{Z as ie}from"./zap-DLPGwyrR.js";import{S as te}from"./sun-YVy46EXd.js";import{L as H}from"./leaf-DoFp5i_f.js";import{T as K}from"./triangle-alert-Do0wWV91.js";import{C as oe}from"./circle-check-C85dceng.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ce=$("chart-column",ae);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],me=$("circle-x",le),g=(n,e)=>e.some(r=>n instanceof r);let W,F;function ue(){return W||(W=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function he(){return F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const b=new WeakMap,x=new WeakMap,d=new WeakMap;function de(n){const e=new Promise((r,a)=>{const t=()=>{n.removeEventListener("success",o),n.removeEventListener("error",i)},o=()=>{r(h(n.result)),t()},i=()=>{a(n.error),t()};n.addEventListener("success",o),n.addEventListener("error",i)});return d.set(e,n),e}function xe(n){if(b.has(n))return;const e=new Promise((r,a)=>{const t=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",i),n.removeEventListener("abort",i)},o=()=>{r(),t()},i=()=>{a(n.error||new DOMException("AbortError","AbortError")),t()};n.addEventListener("complete",o),n.addEventListener("error",i),n.addEventListener("abort",i)});b.set(n,e)}let y={get(n,e,r){if(n instanceof IDBTransaction){if(e==="done")return b.get(n);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return h(n[e])},set(n,e,r){return n[e]=r,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Z(n){y=n(y)}function fe(n){return he().includes(n)?function(...e){return n.apply(j(this),e),h(this.request)}:function(...e){return h(n.apply(j(this),e))}}function ge(n){return typeof n=="function"?fe(n):(n instanceof IDBTransaction&&xe(n),g(n,ue())?new Proxy(n,y):n)}function h(n){if(n instanceof IDBRequest)return de(n);if(x.has(n))return x.get(n);const e=ge(n);return e!==n&&(x.set(n,e),d.set(e,n)),e}const j=n=>d.get(n);function be(n,e,{blocked:r,upgrade:a,blocking:t,terminated:o}={}){const i=indexedDB.open(n,e),m=h(i);return a&&i.addEventListener("upgradeneeded",c=>{a(h(i.result),c.oldVersion,c.newVersion,h(i.transaction),c)}),r&&i.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),m.then(c=>{o&&c.addEventListener("close",()=>o()),t&&c.addEventListener("versionchange",u=>t(u.oldVersion,u.newVersion,u))}).catch(()=>{}),m}const ye=["get","getKey","getAll","getAllKeys","count"],je=["put","add","delete","clear"],f=new Map;function R(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(f.get(e))return f.get(e);const r=e.replace(/FromIndex$/,""),a=e!==r,t=je.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(t||ye.includes(r)))return;const o=async function(i,...m){const c=this.transaction(i,t?"readwrite":"readonly");let u=c.store;return a&&(u=u.index(m.shift())),(await Promise.all([u[r](...m),t&&c.done]))[0]};return f.set(e,o),o}Z(n=>({...n,get:(e,r,a)=>R(e,r)||n.get(e,r,a),has:(e,r)=>!!R(e,r)||n.has(e,r)}));const pe=["continue","continuePrimaryKey","advance"],U={},p=new WeakMap,X=new WeakMap,ke={get(n,e){if(!pe.includes(e))return n[e];let r=U[e];return r||(r=U[e]=function(...a){p.set(this,X.get(this)[e](...a))}),r}};async function*we(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;e=e;const r=new Proxy(e,ke);for(X.set(r,e),d.set(r,j(e));e;)yield r,e=await(p.get(r)||e.continue()),p.delete(r)}function z(n,e){return e===Symbol.asyncIterator&&g(n,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&g(n,[IDBIndex,IDBObjectStore])}Z(n=>({...n,get(e,r,a){return z(e,r)?we:n.get(e,r,a)},has(e,r){return z(e,r)||n.has(e,r)}}));const G=async()=>be("myAppDB",1,{upgrade(n){n.objectStoreNames.contains("history")||n.createObjectStore("history",{keyPath:"date"}),n.objectStoreNames.contains("weather")||n.createObjectStore("weather",{keyPath:"id"}),n.objectStoreNames.contains("prediksi")||n.createObjectStore("prediksi",{keyPath:"key"})}}),ve=async(n,e)=>(await G()).put(n,e),Ne=async n=>(await G()).getAll(n),De=n=>n==="-"||n===""||n===null||n===void 0?NaN:Number(n),Ie={ok:"bg-green-50 border-green-300 text-green-700",warn:"bg-yellow-50 border-yellow-300 text-yellow-700",danger:"bg-red-50 border-red-300 text-red-700",missing:"bg-gray-50 border-gray-300 text-gray-500"},Be={ok:s.jsx(oe,{className:"w-5 h-5 text-green-600"}),warn:s.jsx(K,{className:"w-5 h-5 text-yellow-600"}),danger:s.jsx(me,{className:"w-5 h-5 text-red-600"}),missing:s.jsx(K,{className:"w-5 h-5 text-gray-500"})},Ce=n=>/suhu/i.test(n)?s.jsx(se,{className:"w-5 h-5"}):/pH/i.test(n)?s.jsx(_,{className:"w-5 h-5"}):/oksigen/i.test(n)?s.jsx(re,{className:"w-5 h-5"}):/kelembapan|kelembaban/i.test(n)?s.jsx(_,{className:"w-5 h-5"}):/air|energi|listrik/i.test(n)?s.jsx(ie,{className:"w-5 h-5"}):/cahaya/i.test(n)?s.jsx(te,{className:"w-5 h-5"}):/nutrisi|ec/i.test(n)?s.jsx(H,{className:"w-5 h-5"}):s.jsx(H,{className:"w-5 h-5"}),Ee=(n,e)=>e==="-"||e===null||e===void 0?"missing":n.level==="ok"?"ok":n.level==="warning"?"warn":n.level==="danger"?"danger":"missing",l=({domain:n,metric:e,label:r,value:a,extras:t})=>{const o=De(a),i=Number.isFinite(o)?ne(n,e,o,t):{level:"unknown",message:"Data tidak tersedia",target:"-"},m=Ee(i,a),c=i.units||"";return s.jsxs("div",{className:`flex items-start gap-3 rounded-lg border p-3 ${Ie[m]}`,children:[s.jsx("div",{className:"mt-0.5",children:Ce(r)}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"font-medium",children:r}),s.jsxs("div",{className:"flex items-center gap-1",children:[Be[m],s.jsxs("span",{className:"font-semibold",children:[a??"-"," ",c]})]})]}),s.jsxs("div",{className:"text-xs mt-1",children:[i.message," ",s.jsxs("span",{className:"italic",children:["Target: ",i.target]})]})]})]})},Se=({dateKey:n,data:e,usage:r})=>{var a,t,o,i,m,c,u,k,w,v,N,D,I,B,C,E,S,P,A,L,M,T,O;return s.jsxs("div",{className:"rounded-2xl bg-white shadow-md border overflow-hidden hover:shadow-lg transition-all",children:[s.jsx("div",{className:"px-5 py-3 border-b flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("h2",{className:"font-bold text-lg",children:n}),s.jsx("p",{className:"text-sm text-gray-600",children:"Riwayat parameter lengkap"})]})}),s.jsxs("div",{className:"p-5 space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Kolam Ikan"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[s.jsx(l,{domain:"kolam",metric:"suhu",label:"Suhu Air",value:((a=e==null?void 0:e.kolam)==null?void 0:a.suhu)??"-"}),s.jsx(l,{domain:"kolam",metric:"ph",label:"pH Air",value:((t=e==null?void 0:e.kolam)==null?void 0:t.ph)??"-"}),s.jsx(l,{domain:"kolam",metric:"oksigen",label:"Oksigen Terlarut",value:((o=e==null?void 0:e.kolam)==null?void 0:o.oksigen)??"-"}),s.jsx(l,{domain:"kolam",metric:"amonia_total",label:"Amonia",value:((i=e==null?void 0:e.kolam)==null?void 0:i.amonia)??"-",extras:{ph:(m=e==null?void 0:e.kolam)==null?void 0:m.ph,suhu:(c=e==null?void 0:e.kolam)==null?void 0:c.suhu}})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Cacing Sutra"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[s.jsx(l,{domain:"ulat",metric:"suhu",label:"Suhu Air",value:((u=e==null?void 0:e.ulat)==null?void 0:u.suhu)??"-"}),s.jsx(l,{domain:"ulat",metric:"ph",label:"pH Air",value:((k=e==null?void 0:e.ulat)==null?void 0:k.ph)??"-"}),s.jsx(l,{domain:"ulat",metric:"oksigen",label:"Oksigen Terlarut",value:((w=e==null?void 0:e.ulat)==null?void 0:w.oksigen)??"-"}),s.jsx(l,{domain:"ulat",metric:"amonia_total",label:"Amonia",value:((v=e==null?void 0:e.ulat)==null?void 0:v.amonia)??"-"})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Kandang"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[s.jsx(l,{domain:"kandang",metric:"suhu",label:"Suhu Udara",value:((N=e==null?void 0:e.kandang)==null?void 0:N.suhu)??"-",extras:{kelembaban:(D=e==null?void 0:e.kandang)==null?void 0:D.kelembaban}}),s.jsx(l,{domain:"kandang",metric:"kelembaban",label:"Kelembapan Udara",value:((I=e==null?void 0:e.kandang)==null?void 0:I.kelembaban)??"-"}),s.jsx(l,{domain:"kandang",metric:"amonia",label:"Kualitas Udara",value:((B=e==null?void 0:e.kandang)==null?void 0:B.kualitas_udara)??"-"}),s.jsx(l,{domain:"kandang",metric:"intensitas_cahaya",label:"Pencahayaan",value:((C=e==null?void 0:e.kandang)==null?void 0:C.pencahayaan)??"-"})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Hidroponik"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[s.jsx(l,{domain:"hidroponik",metric:"ph",label:"pH Air",value:((E=e==null?void 0:e.hidroponik)==null?void 0:E.ph)??"-"}),s.jsx(l,{domain:"hidroponik",metric:"suhu",label:"Suhu Air",value:((S=e==null?void 0:e.hidroponik)==null?void 0:S.suhu)??"-"}),s.jsx(l,{domain:"hidroponik",metric:"kelembaban",label:"Kelembapan Udara",value:((P=e==null?void 0:e.hidroponik)==null?void 0:P.kelembaban)??"-"}),s.jsx(l,{domain:"hidroponik",metric:"intensitas_cahaya",label:"Intensitas Cahaya",value:((A=e==null?void 0:e.hidroponik)==null?void 0:A.intensitas_cahaya)??"-"}),s.jsx(l,{domain:"hidroponik",metric:"ec",label:"Aliran Nutrisi (EC)",value:((L=e==null?void 0:e.hidroponik)==null?void 0:L.aliran_nutrisi)??"-"})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Penggunaan Sistem"}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[s.jsx(l,{domain:"usage",metric:"energy",label:"Energi (kWh)",value:((M=r==null?void 0:r.energy)==null?void 0:M.value)??"-"}),s.jsx(l,{domain:"usage",metric:"water",label:"Air (L)",value:((T=r==null?void 0:r.water)==null?void 0:T.value)??"-"}),s.jsx(l,{domain:"usage",metric:"efficiency",label:"Efisiensi (%)",value:((O=r==null?void 0:r.efficiency)==null?void 0:O.value)??"-"})]})]})]})]})};function We(){const[n,e]=V.useState({}),r=J();V.useEffect(()=>{if(navigator.onLine){const t=Q(Y(ee,"history"),o=>{const i=o.val()||{};e(i),Object.entries(i).forEach(([m,c])=>{ve("history",{date:m,...c})})});return()=>t()}else(async()=>{const t=await Ne("history"),o={};t.forEach(i=>o[i.date]=i),e(o)})()},[]);const a=Object.keys(n).sort((t,o)=>t<o?1:-1);return s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx(q,{}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Riwayat Harian"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Pantau kondisi lengkap dari semua parameter budidaya."})]}),s.jsxs("button",{onClick:()=>r("/riwayat-chart"),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition",children:[s.jsx(ce,{className:"w-4 h-4"}),"Statistik 7 Hari"]})]}),s.jsx("div",{className:"space-y-6",children:a.length>0?a.map(t=>{var o,i,m,c,u;return s.jsx(Se,{dateKey:t,data:{kolam:(o=n[t])==null?void 0:o.kolam,ulat:(i=n[t])==null?void 0:i.ulat,kandang:(m=n[t])==null?void 0:m.kandang,hidroponik:(c=n[t])==null?void 0:c.hidroponik},usage:(u=n[t])==null?void 0:u.usage},t)}):s.jsx("div",{className:"rounded-xl border p-6 text-center text-gray-500",children:"Belum ada data riwayat."})})]})}export{We as default};
