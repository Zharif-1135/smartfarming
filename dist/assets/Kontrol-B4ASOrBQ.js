import{r as l,j as e}from"./index-Drn00l2W.js";import{c as w,o as F,r as L,p as q,u as A,H as G,S as U,d as _}from"./Header-WEJhPpCK.js";import{C as Y}from"./circle-check-big-shENqhWG.js";import{M as X,i as Z,u as H,P as J,a as Q,b as K,L as ee,m as v,H as te,F as se}from"./proxy-tvoblv6-.js";import{D as S}from"./droplet-CtEa-4et.js";import{a as z,A as ne,W as B}from"./wifi-CBgTlw3m.js";import{B as ae}from"./bug-CTBPflUU.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m7 7 10 10-5 5V2l5 5L7 17",key:"1q5490"}],["line",{x1:"18",x2:"21",y1:"12",y2:"12",key:"1rsjjs"}],["line",{x1:"3",x2:"6",y1:"12",y2:"12",key:"11yl8c"}]],R=w("bluetooth-connected",ie);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m7 7 10 10-5 5V2l5 5L7 17",key:"1q5490"}],["path",{d:"M20.83 14.83a4 4 0 0 0 0-5.66",key:"k8tn1j"}],["path",{d:"M18 12h.01",key:"yjnet6"}]],le=w("bluetooth-searching",oe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m7 7 10 10-5 5V2l5 5L7 17",key:"1q5490"}]],ce=w("bluetooth",re);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M10.827 16.379a6.082 6.082 0 0 1-8.618-7.002l5.412 1.45a6.082 6.082 0 0 1 7.002-8.618l-1.45 5.412a6.082 6.082 0 0 1 8.618 7.002l-5.412-1.45a6.082 6.082 0 0 1-7.002 8.618l1.45-5.412Z",key:"484a7f"}],["path",{d:"M12 12v.01",key:"u5ubse"}]],he=w("fan",de);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],pe=w("history",ue);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],T=w("lightbulb",me);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],fe=w("shield-alert",xe);class ge extends l.Component{getSnapshotBeforeUpdate(i){const t=this.props.childRef.current;if(t&&i.isPresent&&!this.props.isPresent){const d=t.offsetParent,f=Z(d)&&d.offsetWidth||0,c=this.props.sizeRef.current;c.height=t.offsetHeight||0,c.width=t.offsetWidth||0,c.top=t.offsetTop,c.left=t.offsetLeft,c.right=f-c.width-c.left}return null}componentDidUpdate(){}render(){return this.props.children}}function be({children:n,isPresent:i,anchorX:t,root:d}){const f=l.useId(),c=l.useRef(null),g=l.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=l.useContext(X);return l.useInsertionEffect(()=>{const{width:x,height:u,top:j,left:p,right:m}=g.current;if(i||!c.current||!x||!u)return;const s=t==="left"?`left: ${p}`:`right: ${m}`;c.current.dataset.motionPopId=f;const a=document.createElement("style");h&&(a.nonce=h);const o=d??document.head;return o.appendChild(a),a.sheet&&a.sheet.insertRule(`
          [data-motion-pop-id="${f}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${u}px !important;
            ${s}px !important;
            top: ${j}px !important;
          }
        `),()=>{o.contains(a)&&o.removeChild(a)}},[i]),e.jsx(ge,{isPresent:i,childRef:c,sizeRef:g,children:l.cloneElement(n,{ref:c})})}const ye=({children:n,initial:i,isPresent:t,onExitComplete:d,custom:f,presenceAffectsLayout:c,mode:g,anchorX:h,root:x})=>{const u=H(je),j=l.useId();let p=!0,m=l.useMemo(()=>(p=!1,{id:j,initial:i,isPresent:t,custom:f,onExitComplete:s=>{u.set(s,!0);for(const a of u.values())if(!a)return;d&&d()},register:s=>(u.set(s,!1),()=>u.delete(s))}),[t,u,d]);return c&&p&&(m={...m}),l.useMemo(()=>{u.forEach((s,a)=>u.set(a,!1))},[t]),l.useEffect(()=>{!t&&!u.size&&d&&d()},[t]),g==="popLayout"&&(n=e.jsx(be,{isPresent:t,anchorX:h,root:x,children:n})),e.jsx(J.Provider,{value:m,children:n})};function je(){return new Map}const $=n=>n.key||"";function D(n){const i=[];return l.Children.forEach(n,t=>{l.isValidElement(t)&&i.push(t)}),i}const Ne=({children:n,custom:i,initial:t=!0,onExitComplete:d,presenceAffectsLayout:f=!0,mode:c="sync",propagate:g=!1,anchorX:h="left",root:x})=>{const[u,j]=Q(g),p=l.useMemo(()=>D(n),[n]),m=g&&!u?[]:p.map($),s=l.useRef(!0),a=l.useRef(p),o=H(()=>new Map),[r,b]=l.useState(p),[N,C]=l.useState(p);K(()=>{s.current=!1,a.current=p;for(let k=0;k<N.length;k++){const y=$(N[k]);m.includes(y)?o.delete(y):o.get(y)!==!0&&o.set(y,!1)}},[N,m.length,m.join("-")]);const E=[];if(p!==r){let k=[...p];for(let y=0;y<N.length;y++){const M=N[y],I=$(M);m.includes(I)||(k.splice(y,0,M),E.push(M))}return c==="wait"&&E.length&&(k=E),C(D(k)),b(p),null}const{forceRender:O}=l.useContext(ee);return e.jsx(e.Fragment,{children:N.map(k=>{const y=$(k),M=g&&!u?!1:p===N||m.includes(y),I=()=>{if(o.has(y))o.set(y,!0);else return;let P=!0;o.forEach(W=>{W||(P=!1)}),P&&(O==null||O(),C(a.current),g&&(j==null||j()),d&&d())};return e.jsx(ye,{isPresent:M,initial:!s.current||t?void 0:!1,custom:i,presenceAffectsLayout:f,mode:c,root:x,onExitComplete:M?void 0:I,anchorX:h,children:k},y)})})},ke=({isOn:n,onChange:i,disabled:t})=>e.jsx(v.div,{whileTap:{scale:.95},className:"cursor-pointer",children:e.jsx("div",{onClick:()=>!t&&i(),className:`relative flex items-center w-16 h-8 rounded-full p-1 transition-colors duration-300 ease-in-out ${n?"bg-green-500 justify-end":"bg-gray-300 justify-start"} ${t?"opacity-50 cursor-not-allowed":""}`,children:e.jsx(v.div,{layout:!0,transition:{type:"spring",stiffness:700,damping:30},className:"w-6 h-6 bg-white rounded-full shadow-md z-10"})})}),ve=({level:n,onLevelChange:i,disabled:t,theme:d})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:n,onChange:f=>i(parseInt(f.target.value,10)),disabled:t,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg accent-purple-600 disabled:opacity-50"}),e.jsxs("span",{className:`font-bold text-sm w-12 text-right ${d.accentColor}`,children:[n,"%"]})]}),Ce=({isOpen:n,onClose:i,onConfirm:t,title:d,message:f,confirmText:c,Icon:g,theme:h})=>e.jsx(Ne,{children:n&&e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:i,children:e.jsxs(v.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",damping:15,stiffness:200},className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm text-center",onClick:x=>x.stopPropagation(),children:[e.jsx("div",{className:`mx-auto w-16 h-16 flex items-center justify-center rounded-full ${h.bg} mb-4`,children:e.jsx(g,{size:40,className:h.icon})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:d}),e.jsx("p",{className:"text-gray-600 mt-2 mb-6",children:f}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 py-3 bg-gray-200 text-gray-800 font-bold rounded-lg hover:bg-gray-300 transition-all",children:"Batal"}),e.jsx("button",{onClick:t,className:`flex-1 py-3 text-white font-bold rounded-lg transition-all ${h.button}`,children:c})]})]})})}),we=({deviceConfig:n,controlData:i,pairingState:t,onPair:d,onToggle:f,onLevelChange:c,theme:g})=>{const h=(i==null?void 0:i.state)==="ON",x=(i==null?void 0:i.level)??0,u=t==="searching",j=t==="connected",p=u,m=u?{text:"PAIRING...",color:"text-red-500",Icon:B}:j?{text:"DIRECT",color:"text-blue-600",Icon:R}:{text:"FIREBASE",color:"text-gray-500",Icon:B};return e.jsxs("div",{className:`p-4 rounded-xl transition-all duration-300 ${h?"bg-green-50 shadow-sm":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n.icon,{className:h?g.accentColor:"text-gray-500"})," ",e.jsx("span",{className:"font-bold text-gray-800",children:n.title})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v.button,{whileTap:{scale:.9},onClick:d,disabled:p,className:"p-2 rounded-full hover:bg-gray-200 transition-colors",children:[u&&e.jsx(le,{size:20,className:"text-red-500 animate-pulse"}),j&&e.jsx(R,{size:20,className:"text-blue-600"}),!u&&!j&&e.jsx(ce,{size:20,className:"text-gray-500"})]}),e.jsx(ke,{isOn:h,onChange:f,disabled:p})]})]}),n.hasLevel&&e.jsx("div",{className:"mt-3",children:e.jsx(ve,{level:x,onLevelChange:c,disabled:!h||p,theme:g})}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 font-semibold",children:[e.jsx(m.Icon,{size:12,className:m.color}),e.jsx("span",{className:m.color,children:m.text})]}),e.jsx("span",{className:`font-bold ${h?"text-green-700":"text-gray-600"}`,children:h?`ONLINE ${n.hasLevel?`(${x}%)`:""}`:"OFFLINE"})]})]})},Me=({title:n,icon:i,theme:t,children:d})=>e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white rounded-2xl shadow-lg border w-full h-full overflow-hidden",children:[e.jsxs("div",{className:`p-4 flex items-center gap-4 ${t.headerBg}`,children:[e.jsx("icon",{size:32,className:"text-white"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:n})]}),e.jsx("div",{className:"p-4 space-y-3",children:d})]}),V={kolam_ikan:{title:"Kolam Ikan",icon:se,theme:{headerBg:"bg-blue-500",accentColor:"text-blue-600"},devices:{pompa_kolam:{title:"Pompa Air",icon:z},aerator_kolam:{title:"Aerator",icon:S}}},cacing_sutra:{title:"Cacing Sutra",icon:ae,theme:{headerBg:"bg-amber-600",accentColor:"text-amber-700"},devices:{pompa_cacing:{title:"Pompa Air",icon:z},aerator_cacing:{title:"Aerator",icon:S}}},hidroponik:{title:"Hidroponik",icon:U,theme:{headerBg:"bg-emerald-500",accentColor:"text-emerald-600"},devices:{pompa_hidroponik:{title:"Pompa Nutrisi",icon:S},lampu_hidroponik:{title:"Lampu Tumbuh",icon:T,hasLevel:!0}}},kandang:{title:"Kandang",icon:te,theme:{headerBg:"bg-orange-500",accentColor:"text-orange-600"},devices:{kipas_kandang:{title:"Kipas Ventilasi",icon:he},kandang_lampu:{title:"Lampu Kandang",icon:T,hasLevel:!0}}}},Le=Object.values(V).flatMap(n=>Object.keys(n.devices));function Pe(){const[n,i]=l.useState({}),[t,d]=l.useState({}),[f,c]=l.useState([]),[g,h]=l.useState({isOpen:!1});l.useRef({}),l.useEffect(()=>{const s=F(L(_,"kontrol"),o=>{const r=o.val()||{};i(b=>{const N={...b};return Object.keys(r).forEach(C=>{t[C]!=="connected"&&(N[C]=typeof r[C]=="string"?{state:r[C],level:0}:r[C])}),N})}),a=F(L(_,"kontrol_logs"),o=>c(Object.keys(o.val()||{}).map(r=>({id:r,...o.val()[r]})).sort((r,b)=>b.ts-r.ts).slice(0,10)));return()=>{s(),a()}},[t]);const x=l.useCallback(s=>q(L(_,"kontrol_logs"),{...s,ts:Date.now()}),[]),u=l.useCallback(async s=>{},[]),j=l.useCallback(s=>{const a=n[s]||{state:"OFF"},o=a.state==="ON"?"OFF":"ON";i(b=>({...b,[s]:{...a,state:o}}));const r=t[s]==="connected";r||A(L(_,`kontrol/${s}`),{state:o}),x({device:s,action:o,by:r?"Direct":"WebApp"})},[n,t,x]),p=l.useCallback((s,a)=>{const o=n[s]||{state:"OFF"};i(b=>({...b,[s]:{...o,level:a}}));const r=t[s]==="connected";r||A(L(_,`kontrol/${s}`),{level:a}),x({device:s,action:`LEVEL ${a}%`,by:r?"Direct":"WebApp"})},[n,t,x]),m=l.useCallback(s=>{const a=s==="ON";h({isOpen:!0,title:`${a?"Hidupkan":"Matikan"} Semua Alat?`,message:`Anda yakin ingin ${a?"menghidupkan":"mematikan"} semua perangkat?`,confirmText:`Ya, ${a?"Hidupkan":"Matikan"}`,Icon:a?Y:fe,theme:a?{bg:"bg-green-100",icon:"text-green-600",button:"bg-green-600 hover:bg-green-700"}:{bg:"bg-red-100",icon:"text-red-600",button:"bg-red-600 hover:bg-red-700"},onConfirm:()=>{const o=Le.reduce((r,b)=>(r[b]={...n[b]||{level:0},state:s},r),{});i(r=>({...r,...o})),A(L(_,"kontrol"),o),x({device:"SEMUA ALAT",action:s,by:"WebApp"}),h({isOpen:!1})}})},[n,x]);return e.jsxs("div",{className:"flex flex-col w-full bg-gray-100 min-h-screen",children:[e.jsx(G,{}),e.jsx(Ce,{...g,onClose:()=>h({isOpen:!1})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Pusat Kontrol"}),e.jsx("p",{className:"text-md text-gray-500",children:"Kelola dan hubungkan semua perangkat sistem Anda."})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto flex-shrink-0",children:[e.jsx(v.button,{whileTap:{scale:.95},onClick:()=>m("ON"),className:"flex-1 py-2 px-4 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition-all text-sm",children:"Hidup Semua"}),e.jsx(v.button,{whileTap:{scale:.95},onClick:()=>m("OFF"),className:"flex-1 py-2 px-4 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 transition-all text-sm",children:"Mati Semua"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Object.entries(V).map(([s,a])=>e.jsx(Me,{title:a.title,icon:a.icon,theme:a.theme,children:Object.entries(a.devices).map(([o,r])=>e.jsx(we,{deviceConfig:r,controlData:n[o],pairingState:t[o],onPair:()=>u(o),onToggle:()=>j(o),onLevelChange:b=>p(o,b),theme:a.theme},o))},s))}),e.jsx("div",{className:"mt-8",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"bg-white p-5 rounded-2xl shadow-lg border",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 border-b pb-3 flex items-center gap-3",children:[e.jsx(pe,{className:"text-purple-600"})," Log Aktivitas"]}),e.jsx("div",{className:"space-y-2",children:f.length>0?f.map(s=>e.jsxs("div",{className:"p-2.5 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center text-sm odd:bg-gray-50 gap-2",children:[e.jsxs("div",{className:"font-medium flex items-center gap-2 capitalize flex-shrink-0",children:[e.jsx(ne,{size:14})," ",s.device.replace(/_/g," ")]}),e.jsx("span",{className:`font-bold ${(s.action||"").includes("ON")?"text-green-600":(s.action||"").includes("OFF")?"text-red-600":"text-gray-700"}`,children:s.action}),e.jsx("span",{className:"text-gray-500 text-xs text-left sm:text-right w-full sm:w-auto",children:new Date(s.ts).toLocaleString("id-ID")})]},s.id)):e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Belum ada aktivitas."})})]})})]})]})}export{Pe as default};
