import{r as x,j as e}from"./index-CQ9cvPeh.js";import{c as ne,o as k,r as v,H as ie,S as oe,d as y,s as de}from"./Header-BtN0Tjhv.js";import{c as ce}from"./Threshold-D5IVsua9.js";import{m as ue,F as me,H as ge}from"./proxy-VASTRZIG.js";import{L as xe,Z as he}from"./zap-WvK-qEiv.js";import{D as be}from"./droplet-AlEmlmEp.js";import{G as fe}from"./gauge-Bo7nKdEu.js";import{R as ve,L as ye,C as pe,X as je,Y as ke,T as we,a as Ne,b as w}from"./LineChart-DwFR8GvI.js";import{B as Se}from"./bug-DMO9eQId.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Ae=ne("trending-up",$e),Ce=a=>a>0?{text:"text-green-600",border:"border-green-400",bg:"bg-green-50"}:a<0?{text:"text-red-600",border:"border-red-400",bg:"bg-red-50"}:{text:"text-gray-700",border:"border-gray-300",bg:"bg-gray-50"},N=({title:a,value:n,diff:r,Icon:l,color:s})=>{const o=Ce(r);let c=r>0?`+${r}% dari sehari yang lalu`:r<0?`${r}% dari sehari yang lalu`:"Tidak ada perubahan dari kemarin";return e.jsxs("div",{className:`border ${o.border} ${o.bg} rounded-xl shadow p-4 flex flex-col items-start transition-all duration-300 hover:scale-[1.02]`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsx(l,{className:`w-6 h-6 ${s}`}),e.jsx("div",{className:"text-lg font-bold",children:a})]}),e.jsx("div",{className:"text-2xl font-semibold",children:n}),e.jsx("div",{className:`mt-1 text-sm ${o.text}`,children:c})]})},He=(a,n)=>{const r=a.map(s=>s.level),l=n.some(s=>s.value==="-"||s.value===null||s.value===void 0);return l&&r.every(s=>s==="unknown"||s==="danger")?{border:"border-red-400",grad:"from-red-100 to-red-50"}:l?{border:"border-yellow-400",grad:"from-yellow-100 to-yellow-50"}:r.every(s=>s==="ok")?{border:"border-green-400",grad:"from-green-100 to-green-50"}:r.some(s=>s==="warning"||s==="danger")?{border:"border-yellow-400",grad:"from-yellow-100 to-yellow-50"}:{border:"border-gray-300",grad:"from-gray-100 to-gray-50"}},f=({domain:a,title:n,items:r,Icon:l,color:s})=>{const o=r.map(t=>ce(a,t.metric,t.value==="-"?NaN:Number(t.value),t.extras)),c=He(o,r);return e.jsxs("div",{className:`group rounded-2xl shadow-lg p-5 flex flex-col gap-3 border ${c.border} 
        bg-gradient-to-br ${c.grad} transition-all duration-300 hover:scale-[1.02] hover:shadow-md`,children:[e.jsxs("h2",{className:"font-bold text-xl mb-1 flex items-center gap-2",children:[e.jsx(l,{className:`w-6 h-6 ${s} group-hover:scale-110 transition-transform duration-300`}),n]}),e.jsx("div",{className:"text-sm space-y-3 w-full",children:r.map((t,u)=>{const i=o[u],m=t.value==="-"||t.value===null||t.value===void 0?"text-red-600":i.level==="ok"?"text-green-700":i.level==="warning"?"text-yellow-700":i.level==="danger"?"text-red-700":"text-gray-500";return e.jsxs("div",{className:"p-2 rounded-lg bg-white/80 flex flex-col border border-gray-200 shadow-sm transition-all duration-200 hover:scale-[1.01]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`font-medium ${m}`,children:t.label}),e.jsxs("span",{className:`font-bold ${m}`,children:[t.value??"-"," ",i.units]})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1 leading-snug",children:[i.message," ",e.jsx("br",{}),e.jsxs("span",{className:"italic",children:["Target: ",i.target]})]})]},u)})})]})},Te=async(a,n,r)=>{try{await de(v(y,`history/${a}`),{...n,usage:r})}catch(l){console.error("Gagal menyimpan history:",l)}};function Pe(){var c,t,u,i,p,m,S,$,A,C,H,T,I,L,E,K,_,D,M,U,O,P,G,B,R,F,W,X,Y,Z;const[a,n]=x.useState({}),[r,l]=x.useState({energy:{value:0,diff:0},water:{value:0,diff:0},efficiency:{value:0,diff:0}}),[s,o]=x.useState([]);return x.useEffect(()=>{const h=k(v(y,"sensor"),g=>{n(g.val()||{})}),j=k(v(y,"usage"),g=>{const d=g.val()||{};l({energy:d.energy||{value:0,diff:0},water:d.water||{value:0,diff:0},efficiency:d.efficiency||{value:0,diff:0}})}),te=k(v(y,"history"),g=>{const d=g.val()||{},le=Object.keys(d).sort().slice(-7).map(b=>{var V,q,z,J,Q,ee,ae,re,se;return{date:b,energy:((z=(q=(V=d[b])==null?void 0:V.usage)==null?void 0:q.energy)==null?void 0:z.value)||0,water:((ee=(Q=(J=d[b])==null?void 0:J.usage)==null?void 0:Q.water)==null?void 0:ee.value)||0,efficiency:((se=(re=(ae=d[b])==null?void 0:ae.usage)==null?void 0:re.efficiency)==null?void 0:se.value)||0}});o(le)});return()=>{h(),j(),te()}},[]),x.useEffect(()=>{var h;if(Object.keys(a).length>0&&((h=r.energy)!=null&&h.value)){const j=new Date().toISOString().split("T")[0];Te(j,a,r)}},[a,r]),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx(ie,{}),e.jsxs("div",{className:"px-6 pt-4 flex items-center gap-3",children:[e.jsx(ue.div,{initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},transition:{duration:.8},children:e.jsx(xe,{className:"w-10 h-10 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Monitoring"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pantau sistem budidaya Anda"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-6",children:[e.jsx(N,{title:"Penggunaan Energi",value:`${((c=r.energy)==null?void 0:c.value)??0} kWh`,diff:((t=r.energy)==null?void 0:t.diff)??0,Icon:he,color:"text-yellow-500"}),e.jsx(N,{title:"Penggunaan Air",value:`${((u=r.water)==null?void 0:u.value)??0} L`,diff:((i=r.water)==null?void 0:i.diff)??0,Icon:be,color:"text-blue-500"}),e.jsx(N,{title:"Efisiensi Sistem",value:`${((p=r.efficiency)==null?void 0:p.value)??0}%`,diff:((m=r.efficiency)==null?void 0:m.diff)??0,Icon:fe,color:"text-green-600"})]}),e.jsx("div",{className:"px-6 mb-6 transition-opacity duration-700",children:e.jsxs("div",{className:"bg-white border rounded-xl shadow p-4 hover:shadow-lg transition-all duration-300",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-purple-600"}),"Tren 7 Hari Terakhir"]}),e.jsx(ve,{width:"100%",height:300,children:e.jsxs(ye,{data:s,children:[e.jsx(pe,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"date"}),e.jsx(ke,{}),e.jsx(we,{}),e.jsx(Ne,{}),e.jsx(w,{type:"monotone",dataKey:"energy",stroke:"#16a34a",name:"Energi (kWh)"}),e.jsx(w,{type:"monotone",dataKey:"water",stroke:"#2563eb",name:"Air (L)"}),e.jsx(w,{type:"monotone",dataKey:"efficiency",stroke:"#f59e0b",name:"Efisiensi (%)"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-6",children:[e.jsx(f,{domain:"kolam",title:"Kolam Ikan",Icon:me,color:"text-blue-600",items:[{label:"Suhu Air",metric:"suhu",value:((S=a.kolam)==null?void 0:S.suhu)??"-"},{label:"pH Air",metric:"ph",value:(($=a.kolam)==null?void 0:$.ph)??"-"},{label:"Oksigen Terlarut",metric:"oksigen",value:((A=a.kolam)==null?void 0:A.oksigen)??"-"},{label:"Amonia",metric:"amonia_total",value:((C=a.kolam)==null?void 0:C.amonia)??"-",extras:{ph:(H=a.kolam)==null?void 0:H.ph,suhu:(T=a.kolam)==null?void 0:T.suhu}}]}),e.jsx(f,{domain:"ulat",title:"Cacing Sutra",Icon:Se,color:"text-amber-800",items:[{label:"Suhu Air",metric:"suhu",value:((I=a.ulat)==null?void 0:I.suhu)!=null?Number((L=a.ulat)==null?void 0:L.suhu):"-"},{label:"pH Air",metric:"ph",value:((E=a.ulat)==null?void 0:E.ph)!=null?Number((K=a.ulat)==null?void 0:K.ph):"-"},{label:"Oksigen Terlarut",metric:"oksigen",value:((_=a.ulat)==null?void 0:_.oksigen)!=null?Number((D=a.ulat)==null?void 0:D.oksigen):"-"},{label:"Amonia",metric:"amonia_total",value:((M=a.ulat)==null?void 0:M.amonia)!=null?Number((U=a.ulat)==null?void 0:U.amonia):"-"}]}),e.jsx(f,{domain:"kandang",title:"Kandang",Icon:ge,color:"text-yellow-600",items:[{label:"Suhu Udara",metric:"suhu",value:((O=a.kandang)==null?void 0:O.suhu)??"-",extras:{kelembaban:(P=a.kandang)==null?void 0:P.kelembaban}},{label:"Kelembapan Udara",metric:"kelembaban",value:((G=a.kandang)==null?void 0:G.kelembaban)??"-"},{label:"Kualitas Udara",metric:"amonia",value:((B=a.kandang)==null?void 0:B.kualitas_udara)??"-"},{label:"Pencahayaan",metric:"intensitas_cahaya",value:((R=a.kandang)==null?void 0:R.pencahayaan)??"-"}]}),e.jsx(f,{domain:"hidroponik",title:"Hidroponik",Icon:oe,color:"text-green-600",items:[{label:"pH Air",metric:"ph",value:((F=a.hidroponik)==null?void 0:F.ph)??"-"},{label:"Suhu Air",metric:"suhu",value:((W=a.hidroponik)==null?void 0:W.suhu)??"-"},{label:"Kelembapan Udara",metric:"kelembaban",value:((X=a.hidroponik)==null?void 0:X.kelembaban)??"-"},{label:"Intensitas Cahaya",metric:"intensitas_cahaya",value:((Y=a.hidroponik)==null?void 0:Y.intensitas_cahaya)??"-"},{label:"Aliran Nutrisi (EC)",metric:"ec",value:((Z=a.hidroponik)==null?void 0:Z.aliran_nutrisi)??"-"}]})]})]})}export{Pe as default};
