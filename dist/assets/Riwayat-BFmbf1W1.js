import{r as H,u as K,j as e}from"./index-OOF8jTm_.js";import{c as D,o as L,r as I,H as M,d as O}from"./Header-B6Sw0EI6.js";import{c as P}from"./Threshold-BFHgkqRB.js";import{g as R,T as S,s as U}from"./db-B8z9Extj.js";import{T as z,W as V,S as W}from"./wind-D6kVABzr.js";import{D as E}from"./droplets-hX9E7Djb.js";import{Z as F,L as T}from"./zap-PD_T1NJx.js";import{C as Z}from"./circle-check-CERuLZPg.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],q=D("chart-column",$);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],X=D("circle-x",B),G=i=>i==="-"||i===""||i===null||i===void 0?NaN:Number(i),J={ok:"bg-green-50 border-green-300 text-green-700",warn:"bg-yellow-50 border-yellow-300 text-yellow-700",danger:"bg-red-50 border-red-300 text-red-700",missing:"bg-gray-50 border-gray-300 text-gray-500"},Q={ok:e.jsx(Z,{className:"w-5 h-5 text-green-600"}),warn:e.jsx(S,{className:"w-5 h-5 text-yellow-600"}),danger:e.jsx(X,{className:"w-5 h-5 text-red-600"}),missing:e.jsx(S,{className:"w-5 h-5 text-gray-500"})},Y=i=>/suhu/i.test(i)?e.jsx(z,{className:"w-5 h-5"}):/pH/i.test(i)?e.jsx(E,{className:"w-5 h-5"}):/oksigen/i.test(i)?e.jsx(V,{className:"w-5 h-5"}):/kelembapan|kelembaban/i.test(i)?e.jsx(E,{className:"w-5 h-5"}):/air|energi|listrik/i.test(i)?e.jsx(F,{className:"w-5 h-5"}):/cahaya/i.test(i)?e.jsx(W,{className:"w-5 h-5"}):/nutrisi|ec/i.test(i)?e.jsx(T,{className:"w-5 h-5"}):e.jsx(T,{className:"w-5 h-5"}),ee=(i,s)=>s==="-"||s===null||s===void 0?"missing":i.level==="ok"?"ok":i.level==="warning"?"warn":i.level==="danger"?"danger":"missing",n=({domain:i,metric:s,label:o,value:c,extras:r})=>{const a=G(c),l=Number.isFinite(a)?P(i,s,a,r):{level:"unknown",message:"Data tidak tersedia",target:"-"},m=ee(l,c),t=l.units||"";return e.jsxs("div",{className:`flex items-start gap-3 rounded-lg border p-3 ${J[m]}`,children:[e.jsx("div",{className:"mt-0.5",children:Y(o)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:o}),e.jsxs("div",{className:"flex items-center gap-1",children:[Q[m],e.jsxs("span",{className:"font-semibold",children:[c??"-"," ",t]})]})]}),e.jsxs("div",{className:"text-xs mt-1",children:[l.message," ",e.jsxs("span",{className:"italic",children:["Target: ",l.target]})]})]})]})},se=({dateKey:i,data:s,usage:o})=>{var c,r,a,l,m,t,h,x,u,d,g,j,p,k,b,f,v,y,N,w,C,A,_;return e.jsxs("div",{className:"rounded-2xl bg-white shadow-md border overflow-hidden hover:shadow-lg transition-all",children:[e.jsx("div",{className:"px-5 py-3 border-b flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg",children:i}),e.jsx("p",{className:"text-sm text-gray-600",children:"Riwayat parameter lengkap"})]})}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Kolam Ikan"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx(n,{domain:"kolam",metric:"suhu",label:"Suhu Air",value:((c=s==null?void 0:s.kolam)==null?void 0:c.suhu)??"-"}),e.jsx(n,{domain:"kolam",metric:"ph",label:"pH Air",value:((r=s==null?void 0:s.kolam)==null?void 0:r.ph)??"-"}),e.jsx(n,{domain:"kolam",metric:"oksigen",label:"Oksigen Terlarut",value:((a=s==null?void 0:s.kolam)==null?void 0:a.oksigen)??"-"}),e.jsx(n,{domain:"kolam",metric:"amonia_total",label:"Amonia",value:((l=s==null?void 0:s.kolam)==null?void 0:l.amonia)??"-",extras:{ph:(m=s==null?void 0:s.kolam)==null?void 0:m.ph,suhu:(t=s==null?void 0:s.kolam)==null?void 0:t.suhu}})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Cacing Sutra"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx(n,{domain:"ulat",metric:"suhu",label:"Suhu Air",value:((h=s==null?void 0:s.ulat)==null?void 0:h.suhu)??"-"}),e.jsx(n,{domain:"ulat",metric:"ph",label:"pH Air",value:((x=s==null?void 0:s.ulat)==null?void 0:x.ph)??"-"}),e.jsx(n,{domain:"ulat",metric:"oksigen",label:"Oksigen Terlarut",value:((u=s==null?void 0:s.ulat)==null?void 0:u.oksigen)??"-"}),e.jsx(n,{domain:"ulat",metric:"amonia_total",label:"Amonia",value:((d=s==null?void 0:s.ulat)==null?void 0:d.amonia)??"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Kandang"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx(n,{domain:"kandang",metric:"suhu",label:"Suhu Udara",value:((g=s==null?void 0:s.kandang)==null?void 0:g.suhu)??"-",extras:{kelembaban:(j=s==null?void 0:s.kandang)==null?void 0:j.kelembaban}}),e.jsx(n,{domain:"kandang",metric:"kelembaban",label:"Kelembapan Udara",value:((p=s==null?void 0:s.kandang)==null?void 0:p.kelembaban)??"-"}),e.jsx(n,{domain:"kandang",metric:"amonia",label:"Kualitas Udara",value:((k=s==null?void 0:s.kandang)==null?void 0:k.kualitas_udara)??"-"}),e.jsx(n,{domain:"kandang",metric:"intensitas_cahaya",label:"Pencahayaan",value:((b=s==null?void 0:s.kandang)==null?void 0:b.pencahayaan)??"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Hidroponik"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx(n,{domain:"hidroponik",metric:"ph",label:"pH Air",value:((f=s==null?void 0:s.hidroponik)==null?void 0:f.ph)??"-"}),e.jsx(n,{domain:"hidroponik",metric:"suhu",label:"Suhu Air",value:((v=s==null?void 0:s.hidroponik)==null?void 0:v.suhu)??"-"}),e.jsx(n,{domain:"hidroponik",metric:"kelembaban",label:"Kelembapan Udara",value:((y=s==null?void 0:s.hidroponik)==null?void 0:y.kelembaban)??"-"}),e.jsx(n,{domain:"hidroponik",metric:"intensitas_cahaya",label:"Intensitas Cahaya",value:((N=s==null?void 0:s.hidroponik)==null?void 0:N.intensitas_cahaya)??"-"}),e.jsx(n,{domain:"hidroponik",metric:"ec",label:"Aliran Nutrisi (EC)",value:((w=s==null?void 0:s.hidroponik)==null?void 0:w.aliran_nutrisi)??"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-emerald-700",children:"Penggunaan Sistem"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[e.jsx(n,{domain:"usage",metric:"energy",label:"Energi (kWh)",value:((C=o==null?void 0:o.energy)==null?void 0:C.value)??"-"}),e.jsx(n,{domain:"usage",metric:"water",label:"Air (L)",value:((A=o==null?void 0:o.water)==null?void 0:A.value)??"-"}),e.jsx(n,{domain:"usage",metric:"efficiency",label:"Efisiensi (%)",value:((_=o==null?void 0:o.efficiency)==null?void 0:_.value)??"-"})]})]})]})]})};function te(){const[i,s]=H.useState({}),o=K();H.useEffect(()=>{if(navigator.onLine){const r=L(I(O,"history"),a=>{const l=a.val()||{};s(l),Object.entries(l).forEach(([m,t])=>{U("history",{date:m,...t})})});return()=>r()}else(async()=>{const r=await R("history"),a={};r.forEach(l=>a[l.date]=l),s(a)})()},[]);const c=Object.keys(i).sort((r,a)=>r<a?1:-1);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(M,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Riwayat Harian"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pantau kondisi lengkap dari semua parameter budidaya."})]}),e.jsxs("button",{onClick:()=>o("/riwayat-chart"),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition",children:[e.jsx(q,{className:"w-4 h-4"}),"Statistik 7 Hari"]})]}),e.jsx("div",{className:"space-y-6",children:c.length>0?c.map(r=>{var a,l,m,t,h;return e.jsx(se,{dateKey:r,data:{kolam:(a=i[r])==null?void 0:a.kolam,ulat:(l=i[r])==null?void 0:l.ulat,kandang:(m=i[r])==null?void 0:m.kandang,hidroponik:(t=i[r])==null?void 0:t.hidroponik},usage:(h=i[r])==null?void 0:h.usage},r)}):e.jsx("div",{className:"rounded-xl border p-6 text-center text-gray-500",children:"Belum ada data riwayat."})})]})}export{te as default};
