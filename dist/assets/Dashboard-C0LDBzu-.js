import{r as x,j as a}from"./index-CQ9cvPeh.js";import{c as B,r as me,o as Ve,H as He,S as Fe,d as ue,s as Re}from"./Header-BtN0Tjhv.js";import{c as he}from"./Threshold-D5IVsua9.js";import{A as Ke}from"./activity-BgbaUezr.js";import{m as P,F as Ue,H as Ie}from"./proxy-VASTRZIG.js";import{T as f,S as L,W as xe}from"./wind-Du9xN97G.js";import{G}from"./gauge-Bo7nKdEu.js";import{W as Oe}from"./waves-D9t4OIEk.js";import{D as O}from"./droplet-AlEmlmEp.js";import{T as Y}from"./triangle-alert-DHDZ2Caj.js";import{B as Be}from"./bug-DMO9eQId.js";import{C as pe}from"./cloud-sun-Dc4tWsM1.js";import{C as ze}from"./circle-check-I47D2P1L.js";import{C as Le}from"./cloud-rain-Dy6C-SR9.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ge=B("clock",Ge);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],be=B("cloud",Ye);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ze=B("wifi-off",Xe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Je=B("wifi",qe),ke="zpka_dd013fe7458d4c34ba195d242ea840d4_1a3c2bfa",fe="205120",Qe=n=>{if(!Number.isFinite(n))return"-";const z=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],y=Math.round(n/22.5)%16;return z[y]};function xa(){const[n,z]=x.useState({hidroponik:{suhu:"-",ph:"-",kelembaban:"-",intensitas_cahaya:"-",aliran_nutrisi:"-"},kandang:{suhu:"-",kelembaban:"-",amonia:"-",kualitas_udara:"-",pencahayaan:"-"},kolam:{suhu:"-",ph:"-",oksigen:"-",amonia:"-"},ulat:{suhu:"-",ph:"-",oksigen:"-",amonia:"-",kelembaban:"-",intensitas_cahaya:"-"}}),[y,je]=x.useState(Date.now()),[X,Z]=x.useState([]),[q,Ne]=x.useState(null),[J,we]=x.useState(null),[ve,Q]=x.useState(!0);x.useEffect(()=>{let e=!1;async function s(){var t;try{Q(!0);const o=await(await fetch(`https://dataservice.accuweather.com/currentconditions/v1/${fe}?apikey=${ke}&details=true&language=id`)).json(),r=await(await fetch(`https://dataservice.accuweather.com/forecasts/v1/daily/1day/${fe}?apikey=${ke}&details=true&metric=true&language=id`)).json();e||(Ne(Array.isArray(o)?o[0]:null),we(((t=r==null?void 0:r.DailyForecasts)==null?void 0:t[0])||null))}catch(l){console.error("Gagal ambil data cuaca:",l)}finally{e||Q(!1)}}return s(),()=>{e=!0}},[]),x.useEffect(()=>{const e=me(ue,"sensor"),s=Ve(e,t=>{const l=t.val();if(l){z(l);const o=Date.now();je(o);const i=new Date().toISOString().split("T")[0],r=me(ue,`history/${i}`);Re(r,l);const m=Se(l,o);Z(m.slice(0,10))}else Z([{id:"no-data",severity:"danger",title:"Data sensor tidak ditemukan",detail:"Tidak ada data sensor di database. Periksa koneksi perangkat atau path 'sensor'."}])});return()=>s()},[]);const j=e=>{if(e==="-"||e===null||e===void 0||e==="")return NaN;const s=parseFloat(e);return Number.isFinite(s)?s:NaN},A=(e,s,t,l={},o=y)=>{if(Date.now()-o>6e4||t==="-"||t===null||t===void 0||Number.isNaN(j(t)))return{label:"Mati",color:"bg-gray-500",bg:"bg-gray-100",severity:"danger"};const r=he(e,s,j(t),l),m={ok:{label:"Optimal",color:"bg-green-500",bg:"bg-green-50",severity:"info"},warning:{label:"Waspada",color:"bg-yellow-500",bg:"bg-yellow-50",severity:"warning"},danger:{label:"Bahaya",color:"bg-red-500",bg:"bg-red-50",severity:"danger"},unknown:{label:"–",color:"bg-gray-400",bg:"bg-white",severity:"info"}};return m[r.level]||m.unknown};function Se(e,s){var r,m,h,V,H,F,R,K,U,I,N,w,v,S,C,M,$,D,_,W;const t=[],l=(c,p,g,b)=>{t.push({id:c,severity:p,title:g,detail:b})};["kolam","hidroponik","kandang","ulat"].forEach(c=>{e[c]||l(`${c}-missing`,"danger",`${ye(c)}: data tidak tersedia`,`Path sensor "${c}" tidak ditemukan atau offline.`)});const i=(c,p,g,b={})=>{const T=j(g);if(Number.isNaN(T))return;const k=he(c,p,T,b);k.level!=="ok"&&l(`${c}-${p}`,k.level,`${ye(c)}: ${p.replace(/_/g," ")} tidak optimal`,k.message)};return i("kolam","suhu",(r=e.kolam)==null?void 0:r.suhu),i("kolam","ph",(m=e.kolam)==null?void 0:m.ph),i("kolam","oksigen",(h=e.kolam)==null?void 0:h.oksigen),i("kolam","amonia_total",(V=e.kolam)==null?void 0:V.amonia,{ph:(H=e.kolam)==null?void 0:H.ph,suhu:(F=e.kolam)==null?void 0:F.suhu}),i("ulat","suhu",(R=e.ulat)==null?void 0:R.suhu),i("ulat","ph",(K=e.ulat)==null?void 0:K.ph),i("ulat","oksigen",(U=e.ulat)==null?void 0:U.oksigen),i("ulat","amonia_total",(I=e.ulat)==null?void 0:I.amonia),i("kandang","suhu",(N=e.kandang)==null?void 0:N.suhu,{kelembaban:j((w=e.kandang)==null?void 0:w.kelembaban)}),i("kandang","kelembaban",(v=e.kandang)==null?void 0:v.kelembaban),i("kandang","amonia",(S=e.kandang)==null?void 0:S.kualitas_udara),i("kandang","intensitas_cahaya",(C=e.kandang)==null?void 0:C.pencahayaan),i("hidroponik","ph",(M=e.hidroponik)==null?void 0:M.ph),i("hidroponik","suhu",($=e.hidroponik)==null?void 0:$.suhu),i("hidroponik","kelembaban",(D=e.hidroponik)==null?void 0:D.kelembaban),i("hidroponik","intensitas_cahaya",(_=e.hidroponik)==null?void 0:_.intensitas_cahaya),i("hidroponik","ec",(W=e.hidroponik)==null?void 0:W.aliran_nutrisi),Date.now()-s>6e4&&l("data-stale","danger","Data tidak up-to-date","Tidak menerima data baru dalam 60 detik. Periksa koneksi."),t.length===0&&t.push({id:"ok",severity:"info",title:"Semua parameter normal",detail:"Tidak ditemukan anomali. Sistem bekerja normal."}),t}const Ce=e=>!e||e.length===0?"info":e.some(s=>s.severity==="danger")?"danger":e.some(s=>s.severity==="warning")?"warning":"info",Me=e=>{const s=[{id:"kolam",label:"Kolam Ikan",data:n.kolam},{id:"hidroponik",label:"Hidroponik",data:n.hidroponik},{id:"kandang",label:"Kandang",data:n.kandang},{id:"ulat",label:"Cacing Sutra",data:n.ulat}],t=[];return s.forEach(l=>{const o=l.data;let i=!1;o&&(i=Object.values(o).some(h=>h!=="-"&&h!==null&&h!==void 0&&h!==""));const r=(e||[]).some(m=>m.id===`${l.id}-missing`);(!i||r)&&t.push({id:l.id,label:l.label,severity:"danger"})}),t.length>0?t.slice(0,4):[{id:"all-ok",label:"Semua sistem online",severity:"info"}]},ee=({severity:e,children:s})=>{const t={danger:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-emerald-600 text-white"};return a.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold ${t[e]||""}`,children:s})},E=({title:e,items:s,status:t,icon:l})=>a.jsxs(P.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.35},whileHover:{y:-2},className:`relative overflow-hidden rounded-2xl border shadow-sm ${t.bg}`,children:[a.jsx("div",{className:"absolute -right-6 -top-6 opacity-10",children:a.jsx(l,{className:"w-24 h-24"})}),a.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(l,{className:"w-5 h-5 text-emerald-700"}),a.jsx("h2",{className:"font-bold text-lg",children:e})]}),a.jsx(ee,{severity:t.severity,children:t.label})]}),a.jsx("div",{className:"text-sm w-full mt-1 divide-y divide-gray-200/70 bg-white/60 rounded-xl border",children:s.map((o,i)=>a.jsxs("div",{className:"flex justify-between items-center py-2 px-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[o.icon,a.jsx("span",{children:o.label})]}),a.jsxs("div",{className:"font-semibold",children:[o.value," ",o.unit]})]},i))})]})]}),$e=({alertsList:e})=>{const s=Ce(e),t={danger:"bg-red-50 border-red-400 text-red-800",warning:"bg-yellow-50 border-yellow-400 text-yellow-800",info:"bg-emerald-50 border-emerald-400 text-emerald-800"},l=10,o=(e||[]).slice(0,l),i=Math.max(0,((e==null?void 0:e.length)||0)-l);return a.jsxs(P.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:`w-full p-4 rounded-2xl border ${t[s]}`,children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[s==="danger"?a.jsx(Y,{className:"w-5 h-5"}):s==="warning"?a.jsx(pe,{className:"w-5 h-5"}):a.jsx(ze,{className:"w-5 h-5"}),a.jsx("h2",{className:"font-bold text-lg",children:"Peringatan Terbaru"})]}),a.jsx(ee,{severity:s,children:s.toUpperCase()})]}),a.jsxs("div",{className:"mt-4 grid gap-2 max-h-72 overflow-y-auto",children:[o.map(r=>a.jsxs("div",{className:"p-3 rounded-xl border bg-white/70 flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold",children:r.title}),a.jsx("div",{className:"text-xs text-gray-700 mt-1",children:r.detail})]}),a.jsx("span",{className:`text-xs px-2 py-1 rounded font-semibold ${r.severity==="danger"?"bg-red-100 text-red-700":r.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-emerald-100 text-emerald-700"}`,children:r.severity.toUpperCase()})]},r.id)),i>0&&a.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:["+",i," peringatan lainnya…"]})]})]})},De=A("kolam","suhu",n.kolam.suhu),_e=A("hidroponik","suhu",n.hidroponik.suhu),We=A("kandang","suhu",n.kandang.suhu,{kelembaban:j(n.kandang.kelembaban)}),Te=A("ulat","suhu",n.ulat.suhu),Pe=Me(X),Ae=x.useMemo(()=>{const e=Date.now()-y;if(e<1500)return"baru saja";const s=Math.floor(e/1e3);if(s<60)return`${s} dtk lalu`;const t=Math.floor(s/60);return t<60?`${t} mnt lalu`:`${Math.floor(t/60)} jam lalu`},[y]),Ee=()=>{var N,w,v,S,C,M,$,D,_,W,c,p,g,b,T,k,ae,se,te,ie,ne,le,re,oe,ce,de;const e=q,s=J,t=e==null?void 0:e.UVIndex,l=(e==null?void 0:e.UVIndexText)||"-",o=(v=(w=(N=e==null?void 0:e.Wind)==null?void 0:N.Speed)==null?void 0:w.Metric)==null?void 0:v.Value,i=(C=(S=e==null?void 0:e.Wind)==null?void 0:S.Direction)==null?void 0:C.Degrees,r=(D=($=(M=e==null?void 0:e.WindGust)==null?void 0:M.Speed)==null?void 0:$.Metric)==null?void 0:D.Value,m=e==null?void 0:e.RelativeHumidity,h=(W=(_=e==null?void 0:e.DewPoint)==null?void 0:_.Metric)==null?void 0:W.Value,V=(p=(c=e==null?void 0:e.Temperature)==null?void 0:c.Metric)==null?void 0:p.Value,H=(b=(g=e==null?void 0:e.RealFeelTemperature)==null?void 0:g.Metric)==null?void 0:b.Value;(k=(T=e==null?void 0:e.Visibility)==null?void 0:T.Metric)==null||k.Value;const F=e==null?void 0:e.CloudCover,R=(se=(ae=e==null?void 0:e.Pressure)==null?void 0:ae.Metric)==null?void 0:se.Value,K=(ie=(te=e==null?void 0:e.Ceiling)==null?void 0:te.Metric)==null?void 0:ie.Value,U=((ne=s==null?void 0:s.Day)==null?void 0:ne.PrecipitationProbability)??((le=s==null?void 0:s.Night)==null?void 0:le.PrecipitationProbability),I=((re=s==null?void 0:s.Day)==null?void 0:re.ThunderstormProbability)??((oe=s==null?void 0:s.Night)==null?void 0:oe.ThunderstormProbability);return a.jsxs(P.div,{initial:{opacity:0,y:14},animate:{opacity:1,y:0},className:"rounded-2xl border bg-white/80 p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(L,{className:"w-5 h-5 text-amber-500"}),a.jsx("h3",{className:"font-semibold",children:"Kondisi Cuaca Lengkap"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[a.jsx(ge,{className:"w-4 h-4"}),e!=null&&e.LocalObservationDateTime?new Date(e.LocalObservationDateTime).toLocaleString():"–"]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 text-sm",children:[a.jsx(d,{icon:a.jsx(f,{className:"w-4 h-4"}),label:"Suhu",value:u(V,"°C")}),a.jsx(d,{icon:a.jsx(f,{className:"w-4 h-4"}),label:"Suhu Seperti®",value:u(H,"°C")}),a.jsx(d,{icon:a.jsx(O,{className:"w-4 h-4"}),label:"Kelembaban",value:u(m,"%")}),a.jsx(d,{icon:a.jsx(O,{className:"w-4 h-4"}),label:"Titik Embun",value:u(h,"°C")}),a.jsx(d,{icon:a.jsx(L,{className:"w-4 h-4"}),label:"UV Index",value:`${t??"-"} (${l})`}),a.jsx(d,{icon:a.jsx(be,{className:"w-4 h-4"}),label:"Tutupan Awan",value:u(F,"%")}),a.jsx(d,{icon:a.jsx(xe,{className:"w-4 h-4"}),label:"Angin",value:`${u(o,"km/j")}, ${Qe(i)}`}),a.jsx(d,{icon:a.jsx(xe,{className:"w-4 h-4"}),label:"Tiupan",value:u(r,"km/j")}),a.jsx(d,{icon:a.jsx(G,{className:"w-4 h-4"}),label:"Tekanan",value:u(R,"mb")}),a.jsx(d,{icon:a.jsx(be,{className:"w-4 h-4"}),label:"Tinggi Awan",value:u(K,"m")}),a.jsx(d,{icon:a.jsx(Le,{className:"w-4 h-4"}),label:"Prob. Hujan",value:u(U,"%")}),a.jsx(d,{icon:a.jsx(Y,{className:"w-4 h-4"}),label:"Prob. Badai",value:u(I,"%")})]}),s&&a.jsx("div",{className:"mt-3 text-xs text-gray-700",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(pe,{className:"w-4 h-4 text-sky-500"}),a.jsxs("span",{children:["Siang: ",((ce=s==null?void 0:s.Day)==null?void 0:ce.ShortPhrase)||"-","; Malam: ",((de=s==null?void 0:s.Night)==null?void 0:de.ShortPhrase)||"-"]})]})})]})},d=({icon:e,label:s,value:t})=>a.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-white/60 px-3 py-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e,a.jsx("span",{children:s})]}),a.jsx("span",{className:"font-semibold",children:t})]}),u=(e,s)=>{var t;return Number.isFinite(e)?`${(t=e.toFixed)==null?void 0:t.call(e,s==="m"?0:1)} ${s}`:"-"};return a.jsxs("div",{className:"flex flex-col w-full",children:[a.jsx(He,{}),a.jsx("div",{className:"px-6 pt-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 rounded-xl bg-emerald-100",children:a.jsx(Ke,{className:"w-6 h-6 text-emerald-700"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard Smart Farming"}),a.jsxs("div",{className:"text-sm text-gray-600",children:["Pemantauan real-time – ",a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx(ge,{className:"w-4 h-4"})," diperbarui ",Ae]})]})]})]}),a.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-start md:justify-end",children:Pe.map(e=>{const s={danger:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-emerald-600 text-white"};return a.jsxs(P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:`${s[e.severity]} px-3 py-1.5 rounded-full text-xs font-semibold flex items-center gap-1 shadow`,children:[e.severity==="danger"?a.jsx(Ze,{className:"w-4 h-4"}):a.jsx(Je,{className:"w-4 h-4"}),e.label]},e.id)})})]})}),a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-5 p-6",children:[a.jsxs("div",{className:"xl:col-span-3 grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:[a.jsx(E,{title:"Kolam Ikan",icon:Ue,items:[{label:"Suhu",value:n.kolam.suhu,unit:"°C",icon:a.jsx(f,{className:"w-4 h-4 text-emerald-700"})},{label:"pH",value:n.kolam.ph,unit:"",icon:a.jsx(G,{className:"w-4 h-4 text-emerald-700"})},{label:"Oksigen",value:n.kolam.oksigen,unit:"mg/L",icon:a.jsx(Oe,{className:"w-4 h-4 text-emerald-700"})}],status:De}),a.jsx(E,{title:"Hidroponik",icon:Fe,items:[{label:"Suhu",value:n.hidroponik.suhu,unit:"°C",icon:a.jsx(f,{className:"w-4 h-4 text-emerald-700"})},{label:"pH",value:n.hidroponik.ph,unit:"",icon:a.jsx(G,{className:"w-4 h-4 text-emerald-700"})}],status:_e}),a.jsx(E,{title:"Kandang",icon:Ie,items:[{label:"Suhu",value:n.kandang.suhu,unit:"°C",icon:a.jsx(f,{className:"w-4 h-4 text-emerald-700"})},{label:"Kelembaban",value:n.kandang.kelembaban,unit:"%",icon:a.jsx(O,{className:"w-4 h-4 text-emerald-700"})},{label:"Amonia",value:n.kandang.amonia,unit:"ppm",icon:a.jsx(Y,{className:"w-4 h-4 text-emerald-700"})}],status:We}),a.jsx(E,{title:"Cacing Sutra",icon:Be,items:[{label:"Suhu",value:n.ulat.suhu,unit:"°C",icon:a.jsx(f,{className:"w-4 h-4 text-emerald-700"})},{label:"Kelembaban",value:n.ulat.kelembaban,unit:"%",icon:a.jsx(O,{className:"w-4 h-4 text-emerald-700"})},{label:"Intensitas Cahaya",value:n.ulat.intensitas_cahaya,unit:"lux",icon:a.jsx(L,{className:"w-4 h-4 text-emerald-700"})}],status:Te})]}),a.jsx("div",{className:"flex flex-col gap-4",children:!ve&&(q||J)?a.jsx(Ee,{}):a.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-2xl border bg-white/70 p-4 text-sm text-gray-600",children:"Memuat detail cuaca…"})})]}),a.jsx("div",{className:"px-6 pb-8",children:a.jsx($e,{alertsList:X})})]})}function ye(n){return n&&n.charAt(0).toUpperCase()+n.slice(1)}export{xa as default};
