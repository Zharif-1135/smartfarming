import{r as l,j as t}from"./index-CQ9cvPeh.js";import{c as q,o as ee,r as E,H as we,d as $,u as ie,p as te,S as ye,s as _e}from"./Header-BtN0Tjhv.js";import{c as A,u as he,t as je}from"./Threshold-D5IVsua9.js";import{M as Oe,i as Ce,u as Ne,P as Fe,a as Me,b as Se,L as Ae,m as Y,H as Le,F as Ie}from"./proxy-VASTRZIG.js";import{A as ne}from"./activity-BgbaUezr.js";import{B as De}from"./bug-DMO9eQId.js";import{W as Ee}from"./waves-D9t4OIEk.js";import{D as $e}from"./droplet-AlEmlmEp.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M10.827 16.379a6.082 6.082 0 0 1-8.618-7.002l5.412 1.45a6.082 6.082 0 0 1 7.002-8.618l-1.45 5.412a6.082 6.082 0 0 1 8.618 7.002l-5.412-1.45a6.082 6.082 0 0 1-7.002 8.618l1.45-5.412Z",key:"484a7f"}],["path",{d:"M12 12v.01",key:"u5ubse"}]],ze=q("fan",Pe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Re=q("history",He);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Te=q("lightbulb",Ke);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],xe=q("power",Ue);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],We=q("shield-alert",Be);class Ve extends l.Component{getSnapshotBeforeUpdate(c){const n=this.props.childRef.current;if(n&&c.isPresent&&!this.props.isPresent){const g=n.offsetParent,m=Ce(g)&&g.offsetWidth||0,r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft,r.right=m-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Ze({children:e,isPresent:c,anchorX:n,root:g}){const m=l.useId(),r=l.useRef(null),p=l.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:F}=l.useContext(Oe);return l.useInsertionEffect(()=>{const{width:L,height:b,top:f,left:w,right:y}=p.current;if(c||!r.current||!L||!b)return;const N=n==="left"?`left: ${w}`:`right: ${y}`;r.current.dataset.motionPopId=m;const M=document.createElement("style");F&&(M.nonce=F);const u=g??document.head;return u.appendChild(M),M.sheet&&M.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${L}px !important;
            height: ${b}px !important;
            ${N}px !important;
            top: ${f}px !important;
          }
        `),()=>{u.contains(M)&&u.removeChild(M)}},[c]),t.jsx(Ve,{isPresent:c,childRef:r,sizeRef:p,children:l.cloneElement(e,{ref:r})})}const Ge=({children:e,initial:c,isPresent:n,onExitComplete:g,custom:m,presenceAffectsLayout:r,mode:p,anchorX:F,root:L})=>{const b=Ne(Je),f=l.useId();let w=!0,y=l.useMemo(()=>(w=!1,{id:f,initial:c,isPresent:n,custom:m,onExitComplete:N=>{b.set(N,!0);for(const M of b.values())if(!M)return;g&&g()},register:N=>(b.set(N,!1),()=>b.delete(N))}),[n,b,g]);return r&&w&&(y={...y}),l.useMemo(()=>{b.forEach((N,M)=>b.set(M,!1))},[n]),l.useEffect(()=>{!n&&!b.size&&g&&g()},[n]),p==="popLayout"&&(e=t.jsx(Ze,{isPresent:n,anchorX:F,root:L,children:e})),t.jsx(Fe.Provider,{value:y,children:e})};function Je(){return new Map}const ae=e=>e.key||"";function ke(e){const c=[];return l.Children.forEach(e,n=>{l.isValidElement(n)&&c.push(n)}),c}const Ye=({children:e,custom:c,initial:n=!0,onExitComplete:g,presenceAffectsLayout:m=!0,mode:r="sync",propagate:p=!1,anchorX:F="left",root:L})=>{const[b,f]=Me(p),w=l.useMemo(()=>ke(e),[e]),y=p&&!b?[]:w.map(ae),N=l.useRef(!0),M=l.useRef(w),u=Ne(()=>new Map),[se,_]=l.useState(w),[T,X]=l.useState(w);Se(()=>{N.current=!1,M.current=w;for(let I=0;I<T.length;I++){const j=ae(T[I]);y.includes(j)?u.delete(j):u.get(j)!==!0&&u.set(j,!1)}},[T,y.length,y.join("-")]);const Z=[];if(w!==se){let I=[...w];for(let j=0;j<T.length;j++){const B=T[j],J=ae(B);y.includes(J)||(I.splice(j,0,B),Z.push(B))}return r==="wait"&&Z.length&&(I=Z),X(ke(I)),_(w),null}const{forceRender:G}=l.useContext(Ae);return t.jsx(t.Fragment,{children:T.map(I=>{const j=ae(I),B=p&&!b?!1:w===T||y.includes(j),J=()=>{if(u.has(j))u.set(j,!0);else return;let V=!0;u.forEach(a=>{a||(V=!1)}),V&&(G==null||G(),X(M.current),p&&(f==null||f()),g&&g())};return t.jsx(Ge,{isPresent:B,initial:!N.current||n?void 0:!1,custom:c,presenceAffectsLayout:m,mode:r,root:L,onExitComplete:B?void 0:J,anchorX:F,children:I},j)})})},K=()=>Date.now(),U={MIN:60*1e3,SEC:1e3},ve=(e,c,n)=>Math.max(c,Math.min(n,e)),x=e=>e==="-"||e===""||e===null||e===void 0?NaN:Number(e),W=e=>typeof e=="string"?{state:e}:e||{state:"OFF"},qe=(e=600)=>{const c=l.useRef(null);return n=>{c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{n(),c.current=null},e)}},Xe={aerator_kolam:2*U.MIN,pompa_flush_kolam:5*U.MIN,aerator_cacing:2*U.MIN,pompa_cacing:5*U.MIN,kipas_kandang:2*U.MIN,lampu_kandang:2*U.MIN,pompa_nutrisi_hidro:3*U.MIN};function be({checked:e,onChange:c,disabled:n}){return t.jsx("button",{onClick:()=>!n&&c(!e),className:`relative inline-flex h-8 w-16 items-center rounded-full transition-colors duration-300 shadow-inner
        ${e?"bg-emerald-500":"bg-gray-300"}
        ${n?"opacity-60 cursor-not-allowed":"hover:brightness-105"}
      `,"aria-label":"toggle",children:t.jsx("span",{className:`inline-block h-7 w-7 transform rounded-full bg-white shadow-md transition-transform duration-300
          ${e?"translate-x-8":"translate-x-1"}
        `})})}function Qe(){const[e,c]=l.useState({open:!1,title:"",desc:"",resolve:null}),n=l.useCallback((r,p)=>new Promise(F=>c({open:!0,title:r,desc:p,resolve:F})),[]),g=r=>{e.resolve&&e.resolve(r),c(p=>({...p,open:!1}))},m=t.jsx(Ye,{children:e.open&&t.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4",children:t.jsxs(Y.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:10},transition:{type:"spring",stiffness:260,damping:20},className:"w-full max-w-md rounded-2xl bg-white shadow-2xl border overflow-hidden",children:[t.jsxs("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-500 p-4 text-white",children:[t.jsxs("div",{className:"text-lg font-semibold flex items-center gap-2",children:[t.jsx(ne,{size:18})," ",e.title]}),t.jsx("div",{className:"text-xs opacity-90",children:e.desc})]}),t.jsxs("div",{className:"p-4 space-y-3",children:[t.jsx("div",{className:"text-sm text-gray-700",children:"Lanjutkan tindakan ini?"}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300",children:"Tidak"}),t.jsx("button",{onClick:()=>g(!0),className:"px-4 py-2 rounded-xl bg-emerald-600 text-white shadow hover:brightness-110",children:"Ya, lanjutkan"})]})]})]})})});return{ask:n,Dialog:m}}function et({name:e,dev:c,busy:n,onToggle:g,onLevel:m}){const r=W(c),p=(r.state||"OFF")==="ON",F=r.level??null,L=r.ts?K()-r.ts<90*U.SEC:!1,b="rounded-xl border p-4 transition-all duration-300",f="bg-emerald-500 border-emerald-600 text-white shadow-lg",w="bg-white border-gray-300 text-gray-800",y=()=>{const N=e.toLowerCase();return N.includes("aerator")?t.jsx(Ee,{size:18}):N.includes("pompa")?t.jsx($e,{size:18}):N.includes("kipas")?t.jsx(ze,{size:18}):N.includes("lampu")?t.jsx(Te,{size:18}):t.jsx(ne,{size:18})};return t.jsxs(Y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`${b} ${p?f:w}`,children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("h3",{className:"font-semibold text-base flex items-center gap-2",children:[y(),t.jsx("span",{className:"inline-block h-2.5 w-2.5 rounded-full shadow",style:{background:L?"#34d399":"#9ca3af"}}),e]}),t.jsx("span",{className:`text-xs px-2 py-1 rounded flex-shrink-0 ${L?p?"bg-white/20":"bg-emerald-100 text-emerald-800":"bg-gray-200 text-gray-700"}`,children:L?"Online":"Offline"})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[t.jsx(be,{checked:p,onChange:g,disabled:n}),F!==null&&t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:`text-sm ${p?"text-white/90":"text-gray-700"}`,children:["Level: ",t.jsxs("strong",{children:[F,"%"]})]}),t.jsx("input",{type:"range",min:"0",max:"100",value:F,onChange:N=>m(ve(Number(N.target.value),0,100)),className:"w-full accent-emerald-600",disabled:n})]})]}),t.jsxs("div",{className:`text-xs mt-2 ${p?"text-white/80":"text-gray-500"}`,children:["Last update: ",r.ts?new Date(r.ts).toLocaleString():"—"]})]})}function tt({label:e,enabled:c,onChange:n,status:g}){const m=g||{text:"Idle",tone:"info"},r=m.tone==="ok"?"bg-emerald-100 text-emerald-800":m.tone==="warn"?"bg-yellow-100 text-yellow-800":m.tone==="danger"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700";return t.jsx("div",{className:"rounded-xl border p-4 bg-white w-full sm:w-auto",children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"font-semibold text-base flex items-center gap-2",children:[t.jsx(ne,{size:16})," Mode Auto"]}),t.jsx("div",{className:"mt-1 text-xs",children:t.jsx("span",{className:`px-2 py-0.5 rounded ${r}`,children:m.text})})]}),t.jsx(be,{checked:c,onChange:n})]})})}function dt(){const[e,c]=l.useState({}),[n,g]=l.useState({}),[m,r]=l.useState({kolam:!1,hidro:!1,kandang:!1,cacing:!1}),[p,F]=l.useState({}),[L,b]=l.useState([]),f=l.useRef({}),w=qe(600),{ask:y,Dialog:N}=Qe();l.useEffect(()=>{const a=ee(E($,"sensor"),i=>c(i.val()||{})),s=ee(E($,"kontrol"),i=>{const h=i.val()||{},k={};Object.keys(h).forEach(O=>k[O]=W(h[O])),g(k)}),o=ee(E($,"kontrol_logs"),i=>{const h=i.val()||{},k=Object.keys(h).map(O=>({id:O,...h[O]})).sort((O,P)=>P.ts-O.ts).slice(0,50);b(k)}),d=ee(E($,"kontrol_auto"),i=>r({kolam:!1,hidro:!1,kandang:!1,cacing:!1,...i.val()||{}}));return()=>{a(),s(),o(),d()}},[]);const M=(a,s,o="web")=>{_e(E($,`kontrol/${a}`),s).then(()=>te(E($,"kontrol_logs"),{device:a,action:JSON.stringify(s),by:o,ts:K()})).catch(console.error)},u=async(a,s,o=!1,d="web")=>{if(p[a]||o&&!await y("Konfirmasi Perintah",`Ubah status ${a} sekarang?`))return;F(h=>({...h,[a]:!0}));const i=typeof s=="string"?{state:s,ts:K()}:{...W(n[a]),...s,ts:K()};w(()=>{M(a,i,d),F(h=>({...h,[a]:!1}))})},se=(a,s,o="web")=>u(a,{level:ve(s,0,100),state:s>0?"ON":"OFF"},!1,o),_=a=>{var d;const s=Xe[a]||2*U.MIN,o=((d=n[a])==null?void 0:d.ts)||0;return K()-o>s},T=async()=>{if(!await y("Mode Darurat","Matikan SEMUA perangkat sekarang?"))return;const s={};["aerator_kolam","pompa_flush_kolam","aerator_cacing","pompa_cacing","kipas_kandang","lampu_kandang","pompa_nutrisi_hidro"].forEach(o=>{s[`kontrol/${o}`]={...W(n[o]),state:"OFF",level:0,ts:K()}}),ie(E($),s).then(()=>{te(E($,"kontrol_logs"),{device:"ALL",action:"EMERGENCY_OFF",by:"web",ts:K()})})},X=async()=>{if(!await y("Hidupkan Semua","Nyalakan semua perangkat dengan level default?"))return;const s={};["aerator_kolam","pompa_flush_kolam","aerator_cacing","pompa_cacing","kipas_kandang","lampu_kandang","pompa_nutrisi_hidro"].forEach(o=>{s[`kontrol/${o}`]={...W(n[o]),state:"ON",level:W(n[o]).level??70,ts:K()}}),ie(E($),s).then(()=>{te(E($,"kontrol_logs"),{device:"ALL",action:"POWER_ALL_ON",by:"web",ts:K()})})},Z=(a,s)=>{r(o=>({...o,[a]:s})),ie(E($),{[`kontrol_auto/${a}`]:s}),te(E($,"kontrol_logs"),{device:`AUTO_${a.toUpperCase()}`,action:s?"ON":"OFF",by:"web",ts:K()})},G=(a,s)=>{var o,d,i;return((i=(d=(o=je)==null?void 0:o[a])==null?void 0:d[s])==null?void 0:i.ok)||[NaN,NaN]};l.useEffect(()=>{const a=setInterval(()=>{var s,o,d,i,h,k,O,P,R,oe,re,le,ce,de,ue,me,ge,pe;if(m.kolam){const z=x((s=e==null?void 0:e.kolam)==null?void 0:s.oksigen),H=x((o=e==null?void 0:e.kolam)==null?void 0:o.amonia),v=x((d=e==null?void 0:e.kolam)==null?void 0:d.ph),S=x((i=e==null?void 0:e.kolam)==null?void 0:i.suhu);if(!Number.isNaN(z)){const D=A("kolam","oksigen",z),C=(((h=n.aerator_kolam)==null?void 0:h.state)||"OFF")==="ON";(D.level==="warning"||D.level==="danger")&&!C&&_("aerator_kolam")&&(u("aerator_kolam",{state:"ON",level:80},!1,"auto"),f.current.kolam={text:"Aerasi: DO rendah → ON",tone:"warn"}),D.level==="ok"&&C&&_("aerator_kolam")&&(u("aerator_kolam",{state:"OFF",level:0},!1,"auto"),f.current.kolam={text:"Aerasi normal",tone:"ok"})}if(!Number.isNaN(H)&&!Number.isNaN(v)&&!Number.isNaN(S)){const{NH3_mgL:D}=he(H,v,S,0),C=A("kolam","amonia_uia",D),Q=(((k=n.pompa_flush_kolam)==null?void 0:k.state)||"OFF")==="ON";(C.level==="warning"||C.level==="danger")&&!Q&&_("pompa_flush_kolam")&&(u("pompa_flush_kolam",{state:"ON",level:80},!0,"auto"),f.current.kolam={text:"Flush: NH₃ tinggi → ON",tone:"danger"}),C.level==="ok"&&Q&&_("pompa_flush_kolam")&&u("pompa_flush_kolam",{state:"OFF",level:0},!0,"auto")}}if(m.cacing){const z=x((O=e==null?void 0:e.cacing_sutra)==null?void 0:O.oksigen),H=x((P=e==null?void 0:e.cacing_sutra)==null?void 0:P.amonia);if(!Number.isNaN(z)){const v=A("cacing_sutra","oksigen",z),S=(((R=n.aerator_cacing)==null?void 0:R.state)||"OFF")==="ON";(v.level==="warning"||v.level==="danger")&&!S&&_("aerator_cacing")&&u("aerator_cacing",{state:"ON",level:70},!1,"auto"),v.level==="ok"&&S&&_("aerator_cacing")&&u("aerator_cacing",{state:"OFF",level:0},!1,"auto"),f.current.cacing=v.level==="ok"?{text:"Aerasi Cacing normal",tone:"ok"}:{text:"Aerasi Cacing: DO rendah",tone:"warn"}}if(!Number.isNaN(H)){const v=A("cacing_sutra","amonia_total",H),S=(((oe=n.pompa_cacing)==null?void 0:oe.state)||"OFF")==="ON";(v.level==="warning"||v.level==="danger")&&!S&&_("pompa_cacing")&&u("pompa_cacing",{state:"ON",level:70},!0,"auto"),v.level==="ok"&&S&&_("pompa_cacing")&&u("pompa_cacing",{state:"OFF",level:0},!0,"auto"),v.level!=="ok"&&(f.current.cacing={text:"Pompa Cacing: Amonia tinggi",tone:"danger"})}}if(m.kandang){const z=x((re=e==null?void 0:e.kandang)==null?void 0:re.suhu),H=x((le=e==null?void 0:e.kandang)==null?void 0:le.kelembaban),v=x((ce=e==null?void 0:e.kandang)==null?void 0:ce.pencahayaan),S=(((de=n.kipas_kandang)==null?void 0:de.state)||"OFF")==="ON";if(!Number.isNaN(z)&&!Number.isNaN(H)){const C=A("kandang","suhu",z,{kelembaban:H});(C.level==="warning"||C.level==="danger")&&!S&&_("kipas_kandang")&&u("kipas_kandang",{state:"ON",level:80},!1,"auto"),C.level==="ok"&&S&&_("kipas_kandang")&&u("kipas_kandang",{state:"OFF",level:0},!1,"auto"),f.current.kandang=C.level==="ok"?{text:"Iklim kandang nyaman",tone:"ok"}:{text:"Ventilasi aktif",tone:"warn"}}const D=(((ue=n.lampu_kandang)==null?void 0:ue.state)||"OFF")==="ON";if(!Number.isNaN(v)){const[C,Q]=G("kandang","intensitas_cahaya"),fe=Math.round((C+Q)/2);v<fe-5&&!D&&_("lampu_kandang")&&u("lampu_kandang",{state:"ON",level:60},!1,"auto"),v>fe+10&&D&&_("lampu_kandang")&&u("lampu_kandang",{state:"OFF",level:0},!1,"auto")}}if(m.hidro){const z=x((me=e==null?void 0:e.hidroponik)==null?void 0:me.ph),H=x((ge=e==null?void 0:e.hidroponik)==null?void 0:ge.suhu),v=(((pe=n.pompa_nutrisi_hidro)==null?void 0:pe.state)||"OFF")==="ON",S=Number.isNaN(z)?{level:"unknown"}:A("hidroponik","ph",z),D=Number.isNaN(H)?{level:"unknown"}:A("hidroponik","suhu",H);[S.level,D.level].some(C=>C==="warning"||C==="danger")&&!v&&_("pompa_nutrisi_hidro")&&u("pompa_nutrisi_hidro",{state:"ON",level:70},!1,"auto"),S.level==="ok"&&D.level==="ok"&&v&&_("pompa_nutrisi_hidro")&&u("pompa_nutrisi_hidro",{state:"OFF",level:0},!1,"auto"),f.current.hidro=S.level==="ok"&&D.level==="ok"?{text:"Hidro stabil",tone:"ok"}:{text:"Sirkulasi aktif (penyesuaian pH/suhu)",tone:"warn"}}},4e3);return()=>clearInterval(a)},[m,e,n]);const I=l.useMemo(()=>({kolam:f.current.kolam||{text:"Idle",tone:"info"},hidro:f.current.hidro||{text:"Idle",tone:"info"},kandang:f.current.kandang||{text:"Idle",tone:"info"},cacing:f.current.cacing||{text:"Idle",tone:"info"}}),[e,n,m]),j=a=>a==="ok"?"bg-emerald-100 text-emerald-800":a==="warn"?"bg-yellow-100 text-yellow-800":a==="danger"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700",B={kolam:(()=>{var i,h,k,O;const a=x((i=e==null?void 0:e.kolam)==null?void 0:i.oksigen),s=x((h=e==null?void 0:e.kolam)==null?void 0:h.amonia),o=x((k=e==null?void 0:e.kolam)==null?void 0:k.ph),d=x((O=e==null?void 0:e.kolam)==null?void 0:O.suhu);if(!Number.isNaN(s)&&!Number.isNaN(o)&&!Number.isNaN(d)){const{NH3_mgL:P}=he(s,o,d,0),R=A("kolam","amonia_uia",P);if(R.level==="danger")return{text:"Amonia tinggi",tone:"danger"};if(R.level==="warning")return{text:"Amonia waspada",tone:"warn"}}if(!Number.isNaN(a)){const P=A("kolam","oksigen",a);if(P.level==="warning")return{text:"DO rendah",tone:"warn"};if(P.level==="danger")return{text:"DO kritis",tone:"danger"}}return{text:"Normal",tone:"ok"}})(),hidro:(()=>{var i,h;const a=x((i=e==null?void 0:e.hidroponik)==null?void 0:i.ph),s=x((h=e==null?void 0:e.hidroponik)==null?void 0:h.suhu),o=Number.isNaN(a)?{level:"unknown"}:A("hidroponik","ph",a),d=Number.isNaN(s)?{level:"unknown"}:A("hidroponik","suhu",s);return o.level==="danger"||d.level==="danger"?{text:"Di luar rentang",tone:"danger"}:o.level==="warning"||d.level==="warning"?{text:"Perlu penyesuaian",tone:"warn"}:{text:"Normal",tone:"ok"}})(),kandang:(()=>{var o,d;const a=x((o=e==null?void 0:e.kandang)==null?void 0:o.suhu),s=x((d=e==null?void 0:e.kandang)==null?void 0:d.kelembaban);if(!Number.isNaN(a)){const i=A("kandang","suhu",a,{kelembaban:s});if(i.level==="danger")return{text:"Panas/lembap tinggi",tone:"danger"};if(i.level==="warning")return{text:"Perlu ventilasi",tone:"warn"}}return{text:"Nyaman",tone:"ok"}})(),cacing:(()=>{var o,d;const a=x((o=e==null?void 0:e.cacing_sutra)==null?void 0:o.oksigen),s=x((d=e==null?void 0:e.cacing_sutra)==null?void 0:d.amonia);if(!Number.isNaN(s)){const i=A("cacing_sutra","amonia_total",s);if(i.level==="danger")return{text:"Amonia tinggi",tone:"danger"};if(i.level==="warning")return{text:"Amonia waspada",tone:"warn"}}if(!Number.isNaN(a)){const i=A("cacing_sutra","oksigen",a);if(i.level==="warning")return{text:"DO rendah",tone:"warn"};if(i.level==="danger")return{text:"DO kritis",tone:"danger"}}return{text:"Stabil",tone:"ok"}})()},J={"Kolam Ikan":[{key:"aerator_kolam",name:"Aerator Kolam"},{key:"pompa_flush_kolam",name:"Pompa Flush Kolam",critical:!0}],Hidroponik:[{key:"pompa_nutrisi_hidro",name:"Pompa Nutrisi Hidroponik"}],Kandang:[{key:"kipas_kandang",name:"Kipas Kandang"},{key:"lampu_kandang",name:"Lampu Kandang"}],"Cacing Sutra":[{key:"aerator_cacing",name:"Aerator Cacing/Ulat"},{key:"pompa_cacing",name:"Pompa Cacing/Ulat",critical:!0}]},V=(a,s)=>{const o=B[s],d=j(o.tone),i=s,h={kolam:t.jsx(Ie,{size:20,className:"text-blue-500"}),hidro:t.jsx(ye,{size:20,className:"text-green-500"}),kandang:t.jsx(Le,{size:20,className:"text-amber-500"}),cacing:t.jsx(De,{size:20,className:"text-red-500"})}[s];return t.jsxs(Y.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"rounded-2xl border bg-white p-4 shadow-sm",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[h,t.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-emerald-500 animate-pulse"}),a]}),t.jsx("div",{className:"mt-1 text-xs",children:t.jsx("span",{className:`px-2 py-0.5 rounded ${d}`,children:o.text})})]}),t.jsx(tt,{enabled:!!m[i],onChange:k=>Z(i,k),status:I[i]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:J[a].map(({key:k,name:O,critical:P})=>t.jsx(et,{name:O,dev:n[k],busy:!!p[k],onToggle:async()=>{const R=(W(n[k]).state||"OFF")==="ON";P&&!await y("Konfirmasi Perangkat Kritis",`${O}: pastikan pergantian aman.`)||u(k,{state:R?"OFF":"ON",level:W(n[k]).level??(R?0:70)},!1)},onLevel:R=>se(k,R)},k))})]})};return t.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[t.jsx(we,{}),t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold tracking-tight bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent flex items-center gap-2",children:[t.jsx(xe,{})," Kontrol Perangkat — SmartFarming"]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Kontrol manual & otomatis per zona."})]}),t.jsxs("div",{className:"flex items-stretch sm:items-center gap-2 flex-col sm:flex-row",children:[t.jsxs("button",{onClick:X,className:"w-full sm:w-auto px-4 py-2 rounded-xl bg-emerald-600 text-white shadow hover:brightness-110 flex items-center justify-center gap-2",children:[t.jsx(xe,{size:16})," Hidupkan Semua"]}),t.jsxs("button",{onClick:T,className:"w-full sm:w-auto px-4 py-2 rounded-xl bg-red-600 text-white shadow hover:brightness-110 flex items-center justify-center gap-2",children:[t.jsx(We,{size:16})," Mode Darurat"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[V("Kolam Ikan","kolam"),V("Hidroponik","hidro"),V("Kandang","kandang"),V("Cacing Sutra","cacing")]}),t.jsxs("div",{className:"rounded-2xl border bg-white p-4 shadow-sm",children:[t.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center gap-2",children:[t.jsx(Re,{})," Riwayat Perintah"]}),t.jsxs("div",{className:"max-h-80 overflow-y-auto space-y-2 pr-2",children:[L.map(a=>{a.action;let s,o;try{const d=JSON.parse(a.action);s=d.state,o=d.level}catch{s=a.action}return t.jsxs(Y.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"p-2.5 border rounded-lg flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 sm:gap-2",children:[t.jsx("div",{children:t.jsxs("div",{className:"font-medium flex items-center flex-wrap gap-x-2",children:[t.jsx(ne,{size:14})," ",t.jsx("span",{children:a.device})," —"," ",t.jsx("span",{className:s==="ON"?"text-green-600 font-semibold":"text-red-600 font-semibold",children:s}),o!==void 0&&t.jsxs("span",{className:"text-xs bg-gray-200 px-2 py-0.5 rounded",children:["Level ",o,"%"]})]})}),t.jsxs("div",{className:"text-xs text-gray-600 sm:text-right flex-shrink-0",children:[new Date(a.ts).toLocaleString("id-ID")," oleh ",t.jsx("strong",{children:a.by})]})]},a.id)}),L.length===0&&t.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:"Belum ada perintah"})]})]}),N]})}export{dt as default};
