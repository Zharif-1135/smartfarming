import{r as x,j as e}from"./index-Drn00l2W.js";import{c as ue,r as ae,o as We,H as _e,S as De,d as se,s as Ee}from"./Header-WEJhPpCK.js";import{c as te}from"./Threshold-oAy1CT4A.js";import{A as ie,W as Ae,a as Te}from"./wifi-CBgTlw3m.js";import{m as _,F as Pe,H as Ke}from"./proxy-tvoblv6-.js";import{T as g,W as ne}from"./wind-CdYYL5U7.js";import{G as F}from"./gauge-D3AKyk4D.js";import{D as H}from"./droplet-CtEa-4et.js";import{T as le}from"./triangle-alert-Do0wWV91.js";import{B as Fe}from"./bug-CTBPflUU.js";import{S as U}from"./sun-YVy46EXd.js";import{C as re}from"./cloud-sun-DrvQvd9-.js";import{C as He}from"./circle-check-C85dceng.js";import{C as Oe}from"./cloud-Bwo_w7cS.js";import{C as Re}from"./cloud-rain-DZ_XVMrm.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],oe=ue("clock",Ie);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ue=ue("wifi-off",Be),de="7efe5acf39a055f8b27dc5055208cc3b",ce=5.18,me=97.15,Ge=n=>{if(!Number.isFinite(n))return"-";const O=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],b=Math.round(n/22.5)%16;return O[b]};function la(){const[n,O]=x.useState({hidroponik:{suhu:"-",ph:"-",kelembaban:"-",intensitas_cahaya:"-",aliran_nutrisi:"-"},kandang:{suhu:"-",kelembaban:"-",amonia:"-",kualitas_udara:"-",pencahayaan:"-"},kolam:{suhu:"-",ph:"-",oksigen:"-",amonia:"-"},ulat:{suhu:"-",ph:"-",oksigen:"-",amonia:"-",kelembaban:"-",intensitas_cahaya:"-"}}),[b,he]=x.useState(Date.now()),[L,z]=x.useState([]),[V,xe]=x.useState(null),[J,pe]=x.useState(null),[ge,X]=x.useState(!0);x.useEffect(()=>{let a=!1;async function s(){var t;try{X(!0);const r=await(await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${ce}&lon=${me}&appid=${de}&units=metric&lang=id`)).json();if(r.cod!==200)throw new Error(r.message||"Gagal mengambil data cuaca saat ini");const i=await(await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${ce}&lon=${me}&appid=${de}&units=metric&lang=id`)).json();if(i.cod!=="200")throw new Error(i.message||"Gagal mengambil data prakiraan");a||(xe(r),pe(((t=i==null?void 0:i.list)==null?void 0:t[0])||null))}catch(l){console.error("Gagal ambil data cuaca:",l)}finally{a||X(!1)}}return s(),()=>{a=!0}},[]),x.useEffect(()=>{const a=ae(se,"sensor"),s=We(a,t=>{const l=t.val();if(l){O(l);const r=Date.now();he(r);const o=new Date().toISOString().split("T")[0],i=ae(se,`history/${o}`);Ee(i,l);const d=be(l,r);z(d.slice(0,10))}else z([{id:"no-data",severity:"danger",title:"Data sensor tidak ditemukan",detail:"Tidak ada data sensor di database. Periksa koneksi perangkat atau path 'sensor'."}])});return()=>s()},[]);const k=a=>{if(a==="-"||a===null||a===void 0||a==="")return NaN;const s=parseFloat(a);return Number.isFinite(s)?s:NaN},D=(a,s,t,l={},r=b)=>{if(Date.now()-r>6e4||t==="-"||t===null||t===void 0||Number.isNaN(k(t)))return{label:"Mati",color:"bg-gray-500",bg:"bg-gray-100",severity:"danger"};const i=te(a,s,k(t),l),d={ok:{label:"Optimal",color:"bg-green-500",bg:"bg-green-50",severity:"info"},warning:{label:"Waspada",color:"bg-yellow-500",bg:"bg-yellow-50",severity:"warning"},danger:{label:"Bahaya",color:"bg-red-500",bg:"bg-red-50",severity:"danger"},unknown:{label:"–",color:"bg-gray-400",bg:"bg-white",severity:"info"}};return d[i.level]||d.unknown};function be(a,s){var d,h,A,T,P,f,K,j,y,N,w,v,S,C,$,M,W,q,Q,Z;const t=[],l={kolam:"Kolam Ikan",hidroponik:"Hidroponik",kandang:"Kandang",ulat:"Cacing Sutra"},r=(c,p,R,I)=>{t.push({id:c,severity:p,title:R,detail:I})};["kolam","hidroponik","kandang","ulat"].forEach(c=>{if(!a[c]){const p=l[c]||G(c);r(`${c}-missing`,"danger",`${p}: data tidak tersedia`,`Path sensor "${c}" tidak ditemukan atau offline.`)}});const i=(c,p,R,I={})=>{const ee=k(R);if(Number.isNaN(ee))return;const B=te(c,p,ee,I);if(B.level!=="ok"){const Me=l[c]||G(c);r(`${c}-${p}`,B.level,`${Me}: ${p.replace(/_/g," ")} tidak optimal`,B.message)}};return i("kolam","suhu",(d=a.kolam)==null?void 0:d.suhu),i("kolam","ph",(h=a.kolam)==null?void 0:h.ph),i("kolam","oksigen",(A=a.kolam)==null?void 0:A.oksigen),i("kolam","amonia_total",(T=a.kolam)==null?void 0:T.amonia,{ph:(P=a.kolam)==null?void 0:P.ph,suhu:(f=a.kolam)==null?void 0:f.suhu}),i("ulat","suhu",(K=a.ulat)==null?void 0:K.suhu),i("ulat","ph",(j=a.ulat)==null?void 0:j.ph),i("ulat","oksigen",(y=a.ulat)==null?void 0:y.oksigen),i("ulat","amonia_total",(N=a.ulat)==null?void 0:N.amonia),i("kandang","suhu",(w=a.kandang)==null?void 0:w.suhu,{kelembaban:k((v=a.kandang)==null?void 0:v.kelembaban)}),i("kandang","kelembaban",(S=a.kandang)==null?void 0:S.kelembaban),i("kandang","amonia",(C=a.kandang)==null?void 0:C.kualitas_udara),i("kandang","intensitas_cahaya",($=a.kandang)==null?void 0:$.pencahayaan),i("hidroponik","ph",(M=a.hidroponik)==null?void 0:M.ph),i("hidroponik","suhu",(W=a.hidroponik)==null?void 0:W.suhu),i("hidroponik","kelembaban",(q=a.hidroponik)==null?void 0:q.kelembaban),i("hidroponik","intensitas_cahaya",(Q=a.hidroponik)==null?void 0:Q.intensitas_cahaya),i("hidroponik","ec",(Z=a.hidroponik)==null?void 0:Z.aliran_nutrisi),Date.now()-s>6e4&&r("data-stale","danger","Data tidak up-to-date","Tidak menerima data baru dalam 60 detik. Periksa koneksi."),t.length===0&&t.push({id:"ok",severity:"info",title:"Semua parameter normal",detail:"Tidak ditemukan anomali. Sistem bekerja normal."}),t}const ke=a=>!a||a.length===0?"info":a.some(s=>s.severity==="danger")?"danger":a.some(s=>s.severity==="warning")?"warning":"info",fe=a=>{const s=[{id:"kolam",label:"Kolam Ikan",data:n.kolam},{id:"hidroponik",label:"Hidroponik",data:n.hidroponik},{id:"kandang",label:"Kandang",data:n.kandang},{id:"ulat",label:"Cacing Sutra",data:n.ulat}],t=[];return s.forEach(l=>{const r=l.data;let o=!1;r&&(o=Object.values(r).some(h=>h!=="-"&&h!==null&&h!==void 0&&h!==""));const i=(a||[]).some(d=>d.id===`${l.id}-missing`);(!o||i)&&t.push({id:l.id,label:l.label,severity:"danger"})}),t.length>0?t.slice(0,4):[{id:"all-ok",label:"Semua sistem online",severity:"info"}]},Y=({severity:a,children:s})=>{const t={danger:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-emerald-600 text-white"};return e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold ${t[a]||""}`,children:s})},E=({title:a,items:s,status:t,icon:l})=>e.jsxs(_.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.35},whileHover:{y:-2},className:`relative overflow-hidden rounded-2xl border shadow-sm ${t.bg}`,children:[e.jsx("div",{className:"absolute -right-6 -top-6 opacity-10",children:e.jsx(l,{className:"w-24 h-24"})}),e.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-5 h-5 text-emerald-700"}),e.jsx("h2",{className:"font-bold text-lg",children:a})]}),e.jsx(Y,{severity:t.severity,children:t.label})]}),e.jsx("div",{className:"text-sm w-full mt-1 divide-y divide-gray-200/70 bg-white/60 rounded-xl border",children:s.map((r,o)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[r.icon,e.jsx("span",{children:r.label})]}),e.jsxs("div",{className:"font-semibold",children:[r.value," ",r.unit]})]},o))})]})]}),je=({alertsList:a})=>{const s=ke(a),t={danger:"bg-red-50 border-red-400 text-red-800",warning:"bg-yellow-50 border-yellow-400 text-yellow-800",info:"bg-emerald-50 border-emerald-400 text-emerald-800"},l=10,r=(a||[]).slice(0,l),o=Math.max(0,((a==null?void 0:a.length)||0)-l);return e.jsxs(_.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:`w-full p-4 rounded-2xl border ${t[s]}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s==="danger"?e.jsx(le,{className:"w-5 h-5"}):s==="warning"?e.jsx(re,{className:"w-5 h-5"}):e.jsx(He,{className:"w-5 h-5"}),e.jsx("h2",{className:"font-bold text-lg",children:"Peringatan Terbaru"})]}),e.jsx(Y,{severity:s,children:s.toUpperCase()})]}),e.jsxs("div",{className:"mt-4 grid gap-2 max-h-72 overflow-y-auto",children:[r.map(i=>e.jsxs("div",{className:"p-3 rounded-xl border bg-white/70 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:i.title}),e.jsx("div",{className:"text-xs text-gray-700 mt-1",children:i.detail})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded font-semibold ${i.severity==="danger"?"bg-red-100 text-red-700":i.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-emerald-100 text-emerald-700"}`,children:i.severity.toUpperCase()})]},i.id)),o>0&&e.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:["+",o," peringatan lainnya…"]})]})]})},ye=D("kolam","suhu",n.kolam.suhu),Ne=D("hidroponik","suhu",n.hidroponik.suhu),we=D("kandang","suhu",n.kandang.suhu,{kelembaban:k(n.kandang.kelembaban)}),ve=D("ulat","suhu",n.ulat.suhu),Se=fe(L),Ce=x.useMemo(()=>{const a=Date.now()-b;if(a<1500)return"baru saja";const s=Math.floor(a/1e3);if(s<60)return`${s} dtk lalu`;const t=Math.floor(s/60);return t<60?`${t} mnt lalu`:`${Math.floor(t/60)} jam lalu`},[b]),$e=()=>{var j,y,N,w,v,S,C,$,M,W;const a=V,s=J,t=((j=a==null?void 0:a.wind)==null?void 0:j.speed)*3.6,l=(y=a==null?void 0:a.wind)==null?void 0:y.deg,r=((N=a==null?void 0:a.wind)==null?void 0:N.gust)*3.6,o=(w=a==null?void 0:a.main)==null?void 0:w.humidity,i=(v=a==null?void 0:a.main)==null?void 0:v.temp,d=(S=a==null?void 0:a.main)==null?void 0:S.feels_like,h=(a==null?void 0:a.visibility)/1e3,A=(C=a==null?void 0:a.clouds)==null?void 0:C.all,T=($=a==null?void 0:a.main)==null?void 0:$.pressure,P=(s==null?void 0:s.pop)*100,f=a!=null&&a.dt?new Date(a.dt*1e3):null,K=((W=(M=s==null?void 0:s.weather)==null?void 0:M[0])==null?void 0:W.description)||"-";return e.jsxs(_.div,{initial:{opacity:0,y:14},animate:{opacity:1,y:0},className:"rounded-2xl border bg-white/80 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-amber-500"}),e.jsx("h3",{className:"font-semibold",children:"Kondisi Cuaca Lengkap"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(oe,{className:"w-4 h-4"}),f?f.toLocaleString():"–"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 text-sm",children:[e.jsx(m,{icon:e.jsx(g,{className:"w-4 h-4"}),label:"Suhu",value:u(i,"°C")}),e.jsx(m,{icon:e.jsx(g,{className:"w-4 h-4"}),label:"Suhu Seperti",value:u(d,"°C")}),e.jsx(m,{icon:e.jsx(H,{className:"w-4 h-4"}),label:"Kelembaban",value:u(o,"%")}),e.jsx(m,{icon:e.jsx(ne,{className:"w-4 h-4"}),label:"Angin",value:`${u(t,"km/j")}, ${Ge(l)}`}),Number.isFinite(r)&&r>0&&e.jsx(m,{icon:e.jsx(ne,{className:"w-4 h-4"}),label:"Tiupan",value:u(r,"km/j")}),e.jsx(m,{icon:e.jsx(Oe,{className:"w-4 h-4"}),label:"Tutupan Awan",value:u(A,"%")}),e.jsx(m,{icon:e.jsx(F,{className:"w-4 h-4"}),label:"Tekanan",value:u(T,"mb")}),e.jsx(m,{icon:e.jsx(ie,{className:"w-4 h-4"}),label:"Visibilitas",value:u(h,"km")}),e.jsx(m,{icon:e.jsx(Re,{className:"w-4 h-4"}),label:"Prob. Presipitasi",value:u(P,"%")}),e.jsx(m,{icon:e.jsx(U,{className:"w-4 h-4 text-gray-400"}),label:"UV Index",value:"N/A (Paid)"}),e.jsx(m,{icon:e.jsx(H,{className:"w-4 h-4 text-gray-400"}),label:"Titik Embun",value:"N/A (Paid)"})]}),s&&e.jsx("div",{className:"mt-3 text-xs text-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-sky-500"}),e.jsxs("span",{children:["Prakiraan (3 Jam): ",G(K)]})]})})]})},m=({icon:a,label:s,value:t})=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-white/60 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[a,e.jsx("span",{children:s})]}),e.jsx("span",{className:"font-semibold",children:t})]}),u=(a,s)=>{var t;return Number.isFinite(a)?`${(t=a.toFixed)==null?void 0:t.call(a,1)} ${s}`:"-"};return e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx(_e,{}),e.jsx("div",{className:"px-6 pt-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-emerald-100",children:e.jsx(ie,{className:"w-6 h-6 text-emerald-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard Smart Farming"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Pemantauan real-time – ",e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"})," diperbarui ",Ce]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-start md:justify-end",children:Se.map(a=>{const s={danger:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-emerald-600 text-white"};return e.jsxs(_.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:`${s[a.severity]} px-3 py-1.5 rounded-full text-xs font-semibold flex items-center gap-1 shadow`,children:[a.severity==="danger"?e.jsx(Ue,{className:"w-4 h-4"}):e.jsx(Ae,{className:"w-4 h-4"}),a.label]},a.id)})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-5 p-6",children:[e.jsxs("div",{className:"xl:col-span-3 grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsx(E,{title:"Kolam Ikan",icon:Pe,items:[{label:"Suhu",value:n.kolam.suhu,unit:"°C",icon:e.jsx(g,{className:"w-4 h-4 text-emerald-700"})},{label:"pH",value:n.kolam.ph,unit:"",icon:e.jsx(F,{className:"w-4 h-4 text-emerald-700"})},{label:"Oksigen",value:n.kolam.oksigen,unit:"mg/L",icon:e.jsx(Te,{className:"w-4 h-4 text-emerald-700"})}],status:ye}),e.jsx(E,{title:"Hidroponik",icon:De,items:[{label:"Suhu",value:n.hidroponik.suhu,unit:"°C",icon:e.jsx(g,{className:"w-4 h-4 text-emerald-700"})},{label:"pH",value:n.hidroponik.ph,unit:"",icon:e.jsx(F,{className:"w-4 h-4 text-emerald-700"})},{label:"intensitas Cahaya",value:n.hidroponik.intensitas_cahaya,unit:"",icon:e.jsx(F,{className:"w-4 h-4 text-emerald-700"})}],status:Ne}),e.jsx(E,{title:"Kandang",icon:Ke,items:[{label:"Suhu",value:n.kandang.suhu,unit:"°C",icon:e.jsx(g,{className:"w-4 h-4 text-emerald-700"})},{label:"Kelembaban",value:n.kandang.kelembaban,unit:"%",icon:e.jsx(H,{className:"w-4 h-4 text-emerald-700"})},{label:"Amonia",value:n.kandang.kualitas_udara,unit:"ppm",icon:e.jsx(le,{className:"w-4 h-4 text-emerald-700"})}],status:we}),e.jsx(E,{title:"Cacing Sutra",icon:Fe,items:[{label:"Suhu",value:n.ulat.suhu,unit:"°C",icon:e.jsx(g,{className:"w-4 h-4 text-emerald-700"})},{label:"Kelembaban",value:n.ulat.kelembaban,unit:"%",icon:e.jsx(H,{className:"w-4 h-4 text-emerald-700"})},{label:"Intensitas Cahaya",value:n.ulat.intensitas_cahaya,unit:"lux",icon:e.jsx(U,{className:"w-4 h-4 text-emerald-700"})}],status:ve})]}),e.jsx("div",{className:"flex flex-col gap-4",children:!ge&&(V||J)?e.jsx($e,{}):e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-2xl border bg-white/70 p-4 text-sm text-gray-600",children:"Memuat detail cuaca…"})})]}),e.jsx("div",{className:"px-6 pb-8",children:e.jsx(je,{alertsList:L})})]})}function G(n){return n&&n.charAt(0).toUpperCase()+n.slice(1)}export{la as default};
