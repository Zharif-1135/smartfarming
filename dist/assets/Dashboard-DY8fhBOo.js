import{r as p,j as a}from"./index-pwG6feGL.js";import{c as X,r as me,o as He,H as Ve,S as Ke,d as ue,s as Fe}from"./Header-7vjCkrzu.js";import{c as he}from"./Threshold-CsRR_yuG.js";import{A as Re,W as Ie,a as Ue}from"./wifi-DpzATbJq.js";import{m as A,F as Oe,H as Be}from"./proxy-D9Z6QvMd.js";import{T as y,W as xe}from"./wind-BLW6IFNa.js";import{G as L}from"./gauge-CN1qgF8f.js";import{D as z}from"./droplet-CNnCo7IA.js";import{T as Y,C as Le}from"./triangle-alert-D7Imva69.js";import{B as ze}from"./bug-hhx5UAMB.js";import{S as q}from"./sun-BK4IpIcM.js";import{C as pe}from"./cloud-DQpJ27YV.js";import{C as Ge}from"./cloud-rain-BwC1KILz.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ge=X("clock",Ye);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]],be=X("cloud-sun",qe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ze=X("wifi-off",Xe),ke="zpka_dd013fe7458d4c34ba195d242ea840d4_1a3c2bfa",ye="205120",Je=n=>{if(!Number.isFinite(n))return"-";const G=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],f=Math.round(n/22.5)%16;return G[f]};function ua(){const[n,G]=p.useState({hidroponik:{suhu:"-",ph:"-",kelembaban:"-",intensitas_cahaya:"-",aliran_nutrisi:"-"},kandang:{suhu:"-",kelembaban:"-",amonia:"-",kualitas_udara:"-",pencahayaan:"-"},kolam:{suhu:"-",ph:"-",oksigen:"-",amonia:"-"},ulat:{suhu:"-",ph:"-",oksigen:"-",amonia:"-",kelembaban:"-",intensitas_cahaya:"-"}}),[f,je]=p.useState(Date.now()),[Z,J]=p.useState([]),[Q,Ne]=p.useState(null),[ee,we]=p.useState(null),[ve,ae]=p.useState(!0);p.useEffect(()=>{let e=!1;async function s(){var t;try{ae(!0);const r=await(await fetch(`https://dataservice.accuweather.com/currentconditions/v1/${ye}?apikey=${ke}&details=true&language=id`)).json(),i=await(await fetch(`https://dataservice.accuweather.com/forecasts/v1/daily/1day/${ye}?apikey=${ke}&details=true&metric=true&language=id`)).json();e||(Ne(Array.isArray(r)?r[0]:null),we(((t=i==null?void 0:i.DailyForecasts)==null?void 0:t[0])||null))}catch(l){console.error("Gagal ambil data cuaca:",l)}finally{e||ae(!1)}}return s(),()=>{e=!0}},[]),p.useEffect(()=>{const e=me(ue,"sensor"),s=He(e,t=>{const l=t.val();if(l){G(l);const r=Date.now();je(r);const c=new Date().toISOString().split("T")[0],i=me(ue,`history/${c}`);Fe(i,l);const m=Se(l,r);J(m.slice(0,10))}else J([{id:"no-data",severity:"danger",title:"Data sensor tidak ditemukan",detail:"Tidak ada data sensor di database. Periksa koneksi perangkat atau path 'sensor'."}])});return()=>s()},[]);const j=e=>{if(e==="-"||e===null||e===void 0||e==="")return NaN;const s=parseFloat(e);return Number.isFinite(s)?s:NaN},E=(e,s,t,l={},r=f)=>{if(Date.now()-r>6e4||t==="-"||t===null||t===void 0||Number.isNaN(j(t)))return{label:"Mati",color:"bg-gray-500",bg:"bg-gray-100",severity:"danger"};const i=he(e,s,j(t),l),m={ok:{label:"Optimal",color:"bg-green-500",bg:"bg-green-50",severity:"info"},warning:{label:"Waspada",color:"bg-yellow-500",bg:"bg-yellow-50",severity:"warning"},danger:{label:"Bahaya",color:"bg-red-500",bg:"bg-red-50",severity:"danger"},unknown:{label:"–",color:"bg-gray-400",bg:"bg-white",severity:"info"}};return m[i.level]||m.unknown};function Se(e,s){var m,x,V,K,F,R,I,U,O,N,w,v,S,C,M,D,$,_,W,T;const t=[],l={kolam:"Kolam Ikan",hidroponik:"Hidroponik",kandang:"Kandang",ulat:"Cacing Sutra"},r=(o,h,g,b)=>{t.push({id:o,severity:h,title:g,detail:b})};["kolam","hidroponik","kandang","ulat"].forEach(o=>{if(!e[o]){const h=l[o]||fe(o);r(`${o}-missing`,"danger",`${h}: data tidak tersedia`,`Path sensor "${o}" tidak ditemukan atau offline.`)}});const i=(o,h,g,b={})=>{const P=j(g);if(Number.isNaN(P))return;const k=he(o,h,P,b);if(k.level!=="ok"){const B=l[o]||fe(o);r(`${o}-${h}`,k.level,`${B}: ${h.replace(/_/g," ")} tidak optimal`,k.message)}};return i("kolam","suhu",(m=e.kolam)==null?void 0:m.suhu),i("kolam","ph",(x=e.kolam)==null?void 0:x.ph),i("kolam","oksigen",(V=e.kolam)==null?void 0:V.oksigen),i("kolam","amonia_total",(K=e.kolam)==null?void 0:K.amonia,{ph:(F=e.kolam)==null?void 0:F.ph,suhu:(R=e.kolam)==null?void 0:R.suhu}),i("ulat","suhu",(I=e.ulat)==null?void 0:I.suhu),i("ulat","ph",(U=e.ulat)==null?void 0:U.ph),i("ulat","oksigen",(O=e.ulat)==null?void 0:O.oksigen),i("ulat","amonia_total",(N=e.ulat)==null?void 0:N.amonia),i("kandang","suhu",(w=e.kandang)==null?void 0:w.suhu,{kelembaban:j((v=e.kandang)==null?void 0:v.kelembaban)}),i("kandang","kelembaban",(S=e.kandang)==null?void 0:S.kelembaban),i("kandang","amonia",(C=e.kandang)==null?void 0:C.kualitas_udara),i("kandang","intensitas_cahaya",(M=e.kandang)==null?void 0:M.pencahayaan),i("hidroponik","ph",(D=e.hidroponik)==null?void 0:D.ph),i("hidroponik","suhu",($=e.hidroponik)==null?void 0:$.suhu),i("hidroponik","kelembaban",(_=e.hidroponik)==null?void 0:_.kelembaban),i("hidroponik","intensitas_cahaya",(W=e.hidroponik)==null?void 0:W.intensitas_cahaya),i("hidroponik","ec",(T=e.hidroponik)==null?void 0:T.aliran_nutrisi),Date.now()-s>6e4&&r("data-stale","danger","Data tidak up-to-date","Tidak menerima data baru dalam 60 detik. Periksa koneksi."),t.length===0&&t.push({id:"ok",severity:"info",title:"Semua parameter normal",detail:"Tidak ditemukan anomali. Sistem bekerja normal."}),t}const Ce=e=>!e||e.length===0?"info":e.some(s=>s.severity==="danger")?"danger":e.some(s=>s.severity==="warning")?"warning":"info",Me=e=>{const s=[{id:"kolam",label:"Kolam Ikan",data:n.kolam},{id:"hidroponik",label:"Hidroponik",data:n.hidroponik},{id:"kandang",label:"Kandang",data:n.kandang},{id:"ulat",label:"Cacing Sutra",data:n.ulat}],t=[];return s.forEach(l=>{const r=l.data;let c=!1;r&&(c=Object.values(r).some(x=>x!=="-"&&x!==null&&x!==void 0&&x!==""));const i=(e||[]).some(m=>m.id===`${l.id}-missing`);(!c||i)&&t.push({id:l.id,label:l.label,severity:"danger"})}),t.length>0?t.slice(0,4):[{id:"all-ok",label:"Semua sistem online",severity:"info"}]},se=({severity:e,children:s})=>{const t={danger:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-emerald-600 text-white"};return a.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold ${t[e]||""}`,children:s})},H=({title:e,items:s,status:t,icon:l})=>a.jsxs(A.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.35},whileHover:{y:-2},className:`relative overflow-hidden rounded-2xl border shadow-sm ${t.bg}`,children:[a.jsx("div",{className:"absolute -right-6 -top-6 opacity-10",children:a.jsx(l,{className:"w-24 h-24"})}),a.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(l,{className:"w-5 h-5 text-emerald-700"}),a.jsx("h2",{className:"font-bold text-lg",children:e})]}),a.jsx(se,{severity:t.severity,children:t.label})]}),a.jsx("div",{className:"text-sm w-full mt-1 divide-y divide-gray-200/70 bg-white/60 rounded-xl border",children:s.map((r,c)=>a.jsxs("div",{className:"flex justify-between items-center py-2 px-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[r.icon,a.jsx("span",{children:r.label})]}),a.jsxs("div",{className:"font-semibold",children:[r.value," ",r.unit]})]},c))})]})]}),De=({alertsList:e})=>{const s=Ce(e),t={danger:"bg-red-50 border-red-400 text-red-800",warning:"bg-yellow-50 border-yellow-400 text-yellow-800",info:"bg-emerald-50 border-emerald-400 text-emerald-800"},l=10,r=(e||[]).slice(0,l),c=Math.max(0,((e==null?void 0:e.length)||0)-l);return a.jsxs(A.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:`w-full p-4 rounded-2xl border ${t[s]}`,children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[s==="danger"?a.jsx(Y,{className:"w-5 h-5"}):s==="warning"?a.jsx(be,{className:"w-5 h-5"}):a.jsx(Le,{className:"w-5 h-5"}),a.jsx("h2",{className:"font-bold text-lg",children:"Peringatan Terbaru"})]}),a.jsx(se,{severity:s,children:s.toUpperCase()})]}),a.jsxs("div",{className:"mt-4 grid gap-2 max-h-72 overflow-y-auto",children:[r.map(i=>a.jsxs("div",{className:"p-3 rounded-xl border bg-white/70 flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold",children:i.title}),a.jsx("div",{className:"text-xs text-gray-700 mt-1",children:i.detail})]}),a.jsx("span",{className:`text-xs px-2 py-1 rounded font-semibold ${i.severity==="danger"?"bg-red-100 text-red-700":i.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-emerald-100 text-emerald-700"}`,children:i.severity.toUpperCase()})]},i.id)),c>0&&a.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:["+",c," peringatan lainnya…"]})]})]})},$e=E("kolam","suhu",n.kolam.suhu),_e=E("hidroponik","suhu",n.hidroponik.suhu),We=E("kandang","suhu",n.kandang.suhu,{kelembaban:j(n.kandang.kelembaban)}),Te=E("ulat","suhu",n.ulat.suhu),Pe=Me(Z),Ae=p.useMemo(()=>{const e=Date.now()-f;if(e<1500)return"baru saja";const s=Math.floor(e/1e3);if(s<60)return`${s} dtk lalu`;const t=Math.floor(s/60);return t<60?`${t} mnt lalu`:`${Math.floor(t/60)} jam lalu`},[f]),Ee=()=>{var N,w,v,S,C,M,D,$,_,W,T,o,h,g,b,P,k,B,te,ie,ne,le,re,oe,ce,de;const e=Q,s=ee,t=e==null?void 0:e.UVIndex,l=(e==null?void 0:e.UVIndexText)||"-",r=(v=(w=(N=e==null?void 0:e.Wind)==null?void 0:N.Speed)==null?void 0:w.Metric)==null?void 0:v.Value,c=(C=(S=e==null?void 0:e.Wind)==null?void 0:S.Direction)==null?void 0:C.Degrees,i=($=(D=(M=e==null?void 0:e.WindGust)==null?void 0:M.Speed)==null?void 0:D.Metric)==null?void 0:$.Value,m=e==null?void 0:e.RelativeHumidity,x=(W=(_=e==null?void 0:e.DewPoint)==null?void 0:_.Metric)==null?void 0:W.Value,V=(o=(T=e==null?void 0:e.Temperature)==null?void 0:T.Metric)==null?void 0:o.Value,K=(g=(h=e==null?void 0:e.RealFeelTemperature)==null?void 0:h.Metric)==null?void 0:g.Value;(P=(b=e==null?void 0:e.Visibility)==null?void 0:b.Metric)==null||P.Value;const F=e==null?void 0:e.CloudCover,R=(B=(k=e==null?void 0:e.Pressure)==null?void 0:k.Metric)==null?void 0:B.Value,I=(ie=(te=e==null?void 0:e.Ceiling)==null?void 0:te.Metric)==null?void 0:ie.Value,U=((ne=s==null?void 0:s.Day)==null?void 0:ne.PrecipitationProbability)??((le=s==null?void 0:s.Night)==null?void 0:le.PrecipitationProbability),O=((re=s==null?void 0:s.Day)==null?void 0:re.ThunderstormProbability)??((oe=s==null?void 0:s.Night)==null?void 0:oe.ThunderstormProbability);return a.jsxs(A.div,{initial:{opacity:0,y:14},animate:{opacity:1,y:0},className:"rounded-2xl border bg-white/80 p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(q,{className:"w-5 h-5 text-amber-500"}),a.jsx("h3",{className:"font-semibold",children:"Kondisi Cuaca Lengkap"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[a.jsx(ge,{className:"w-4 h-4"}),e!=null&&e.LocalObservationDateTime?new Date(e.LocalObservationDateTime).toLocaleString():"–"]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 text-sm",children:[a.jsx(d,{icon:a.jsx(y,{className:"w-4 h-4"}),label:"Suhu",value:u(V,"°C")}),a.jsx(d,{icon:a.jsx(y,{className:"w-4 h-4"}),label:"Suhu Seperti®",value:u(K,"°C")}),a.jsx(d,{icon:a.jsx(z,{className:"w-4 h-4"}),label:"Kelembaban",value:u(m,"%")}),a.jsx(d,{icon:a.jsx(z,{className:"w-4 h-4"}),label:"Titik Embun",value:u(x,"°C")}),a.jsx(d,{icon:a.jsx(q,{className:"w-4 h-4"}),label:"UV Index",value:`${t??"-"} (${l})`}),a.jsx(d,{icon:a.jsx(pe,{className:"w-4 h-4"}),label:"Tutupan Awan",value:u(F,"%")}),a.jsx(d,{icon:a.jsx(xe,{className:"w-4 h-4"}),label:"Angin",value:`${u(r,"km/j")}, ${Je(c)}`}),a.jsx(d,{icon:a.jsx(xe,{className:"w-4 h-4"}),label:"Tiupan",value:u(i,"km/j")}),a.jsx(d,{icon:a.jsx(L,{className:"w-4 h-4"}),label:"Tekanan",value:u(R,"mb")}),a.jsx(d,{icon:a.jsx(pe,{className:"w-4 h-4"}),label:"Tinggi Awan",value:u(I,"m")}),a.jsx(d,{icon:a.jsx(Ge,{className:"w-4 h-4"}),label:"Prob. Hujan",value:u(U,"%")}),a.jsx(d,{icon:a.jsx(Y,{className:"w-4 h-4"}),label:"Prob. Badai",value:u(O,"%")})]}),s&&a.jsx("div",{className:"mt-3 text-xs text-gray-700",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(be,{className:"w-4 h-4 text-sky-500"}),a.jsxs("span",{children:["Siang: ",((ce=s==null?void 0:s.Day)==null?void 0:ce.ShortPhrase)||"-","; Malam: ",((de=s==null?void 0:s.Night)==null?void 0:de.ShortPhrase)||"-"]})]})})]})},d=({icon:e,label:s,value:t})=>a.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-white/60 px-3 py-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e,a.jsx("span",{children:s})]}),a.jsx("span",{className:"font-semibold",children:t})]}),u=(e,s)=>{var t;return Number.isFinite(e)?`${(t=e.toFixed)==null?void 0:t.call(e,s==="m"?0:1)} ${s}`:"-"};return a.jsxs("div",{className:"flex flex-col w-full",children:[a.jsx(Ve,{}),a.jsx("div",{className:"px-6 pt-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 rounded-xl bg-emerald-100",children:a.jsx(Re,{className:"w-6 h-6 text-emerald-700"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard Smart Farming"}),a.jsxs("div",{className:"text-sm text-gray-600",children:["Pemantauan real-time – ",a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx(ge,{className:"w-4 h-4"})," diperbarui ",Ae]})]})]})]}),a.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-start md:justify-end",children:Pe.map(e=>{const s={danger:"bg-red-500 text-white",warning:"bg-yellow-500 text-white",info:"bg-emerald-600 text-white"};return a.jsxs(A.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:`${s[e.severity]} px-3 py-1.5 rounded-full text-xs font-semibold flex items-center gap-1 shadow`,children:[e.severity==="danger"?a.jsx(Ze,{className:"w-4 h-4"}):a.jsx(Ie,{className:"w-4 h-4"}),e.label]},e.id)})})]})}),a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-5 p-6",children:[a.jsxs("div",{className:"xl:col-span-3 grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:[a.jsx(H,{title:"Kolam Ikan",icon:Oe,items:[{label:"Suhu",value:n.kolam.suhu,unit:"°C",icon:a.jsx(y,{className:"w-4 h-4 text-emerald-700"})},{label:"pH",value:n.kolam.ph,unit:"",icon:a.jsx(L,{className:"w-4 h-4 text-emerald-700"})},{label:"Oksigen",value:n.kolam.oksigen,unit:"mg/L",icon:a.jsx(Ue,{className:"w-4 h-4 text-emerald-700"})}],status:$e}),a.jsx(H,{title:"Hidroponik",icon:Ke,items:[{label:"Suhu",value:n.hidroponik.suhu,unit:"°C",icon:a.jsx(y,{className:"w-4 h-4 text-emerald-700"})},{label:"pH",value:n.hidroponik.ph,unit:"",icon:a.jsx(L,{className:"w-4 h-4 text-emerald-700"})},{label:"intensitas Cahaya",value:n.hidroponik.intensitas_cahaya,unit:"",icon:a.jsx(L,{className:"w-4 h-4 text-emerald-700"})}],status:_e}),a.jsx(H,{title:"Kandang",icon:Be,items:[{label:"Suhu",value:n.kandang.suhu,unit:"°C",icon:a.jsx(y,{className:"w-4 h-4 text-emerald-700"})},{label:"Kelembaban",value:n.kandang.kelembaban,unit:"%",icon:a.jsx(z,{className:"w-4 h-4 text-emerald-700"})},{label:"Amonia",value:n.kandang.kualitas_udara,unit:"ppm",icon:a.jsx(Y,{className:"w-4 h-4 text-emerald-700"})}],status:We}),a.jsx(H,{title:"Cacing Sutra",icon:ze,items:[{label:"Suhu",value:n.ulat.suhu,unit:"°C",icon:a.jsx(y,{className:"w-4 h-4 text-emerald-700"})},{label:"Kelembaban",value:n.ulat.kelembaban,unit:"%",icon:a.jsx(z,{className:"w-4 h-4 text-emerald-700"})},{label:"Intensitas Cahaya",value:n.ulat.intensitas_cahaya,unit:"lux",icon:a.jsx(q,{className:"w-4 h-4 text-emerald-700"})}],status:Te})]}),a.jsx("div",{className:"flex flex-col gap-4",children:!ve&&(Q||ee)?a.jsx(Ee,{}):a.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-2xl border bg-white/70 p-4 text-sm text-gray-600",children:"Memuat detail cuaca…"})})]}),a.jsx("div",{className:"px-6 pb-8",children:a.jsx(De,{alertsList:Z})})]})}function fe(n){return n&&n.charAt(0).toUpperCase()+n.slice(1)}export{ua as default};
